"use client"

import { useState, useEffect } from "react"
import { motion, AnimatePresence } from "framer-motion"
import {
  ChevronRight,
  BookOpen,
  Volume2,
  VolumeX,
  Settings,
  Save,
  Menu,
  X,
  Home,
  HelpCircle,
  ArrowLeft,
  ArrowRight,
  FileText,
  Bookmark,
  Play,
} from "lucide-react"
import Image from "next/image"
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"

export default function VisualNovelPage() {
  const [currentScene, setCurrentScene] = useState(0)
  const [dialogIndex, setDialogIndex] = useState(0)
  const [showChoices, setShowChoices] = useState(false)
  const [selectedChoice, setSelectedChoice] = useState<number | null>(null)
  const [gameState, setGameState] = useState<"intro" | "game" | "theory" | "end">("intro")
  const [showMenu, setShowMenu] = useState(false)
  const [isMuted, setIsMuted] = useState(false)
  const [showTheoryModal, setShowTheoryModal] = useState(false)
  const [currentTheoryTopic, setCurrentTheoryTopic] = useState(0)
  const [showCharacterInfo, setShowCharacterInfo] = useState<CharacterKey | null>(null)
  const [showEvidence, setShowEvidence] = useState(false)
  const [evidenceItems, setEvidenceItems] = useState<string[]>([])
  const [showNotebook, setShowNotebook] = useState(false)
  const [notebookEntries, setNotebookEntries] = useState<{ title: string; content: string }[]>([
    {
      title: "Первый день",
      content:
        "Сегодня мой первый день в отделе. Капитан Волков кажется строгим, но справедливым. Надеюсь, я смогу оправдать его ожидания.",
    },
  ])

  type CharacterKey = 'protagonist' | 'captain' | 'partner' | 'suspect' | 'witness' | 'forensic';
  
  type Character = {
    name: string;
    image: string;
    description: string;
  };

  const characters: Record<CharacterKey, Character> = {
    protagonist: {
      name: "Детектив",
      image: "/images/novel/characters/detective.png?height=600&width=400&text=Детектив",
      description:
        "Молодой детектив, недавно переведенный в отдел особо важных дел. Обладает аналитическим складом ума и отличной интуицией.",
    },
    captain: {
      name: "Капитан Волков",
      image: "/images/novel/characters/capitan.png?height=600&width=400&text=Капитан+Волков",
      description:
        "Опытный руководитель отдела с 25-летним стажем. Требовательный, но справедливый. Ценит инициативу и профессионализм.",
    },
    partner: {
      name: "Лейтенант Соколова",
      image: "/images/novel/characters/sukalova.png?height=600&width=400&text=Лейтенант+Соколова",
      description: "Ваш напарник. Опытный оперативник с отличными навыками допроса и работы с информаторами.",
    },
    suspect: {
      name: "Игорь Кравцов",
      image: "/images/novel/characters/Igor.png?height=600&width=400&text=Игорь+Кравцов",
      description: "Главный подозреваемый. Бизнесмен средней руки с сомнительными связями и неясным прошлым.",
    },
    witness: {
      name: "Анна Петрова",
      image: "/images/novel/characters/assist.png?height=600&width=400&text=Анна+Петрова",
      description: "Ключевой свидетель. Секретарь в компании жертвы, обнаружила тело.",
    },
    forensic: {
      name: "Доктор Морозов",
      image: "/images/novel/characters/doctor.png?height=600&width=400&text=Доктор+Морозов",
      description: "Судмедэксперт. Педантичный и дотошный специалист, не упускающий ни одной детали.",
    },
  }

  const theoryTopics = [
    {
      title: "Осмотр места преступления",
      content: `
        <h3>Основные принципы осмотра места преступления</h3>
        <p>Осмотр места преступления - это следственное действие, направленное на обнаружение следов преступления и других вещественных доказательств, выяснение обстановки происшествия и иных обстоятельств, имеющих значение для дела.</p>
        
        <h4>Этапы осмотра:</h4>
        <ol>
          <li><strong>Подготовительный этап</strong> - получение информации о происшествии, обеспечение охраны места происшествия, подготовка технических средств.</li>
          <li><strong>Обзорный этап</strong> - общий осмотр места происшествия для определения его границ и планирования детального осмотра.</li>
          <li><strong>Детальный этап</strong> - тщательное исследование места происшествия, обнаружение, фиксация и изъятие следов.</li>
          <li><strong>Заключительный этап</strong> - составление протокола осмотра, планов, схем, фототаблиц.</li>
        </ol>
        
        <h4>Методы осмотра:</h4>
        <ul>
          <li><strong>Концентрический</strong> - от периферии к центру</li>
          <li><strong>Эксцентрический</strong> - от центра к периферии</li>
          <li><strong>Фронтальный</strong> - линейное движение от одной границы к другой</li>
          <li><strong>Секторный</strong> - осмотр по секторам</li>
          <li><strong>Узловой</strong> - осмотр по узлам (местам наибольшей концентрации следов)</li>
        </ul>
      `,
    },
    {
      title: "Допрос свидетелей",
      content: `
        <h3>Тактика допроса свидетелей</h3>
        <p>Допрос - это следственное действие, заключающееся в получении и фиксации показаний о событии преступления и связанных с ним обстоятельствах.</p>
        
        <h4>Этапы допроса:</h4>
        <ol>
          <li><strong>Подготовительный этап</strong> - изучение материалов дела, личности допрашиваемого, определение тактики допроса.</li>
          <li><strong>Установление психологического контакта</strong> - создание благоприятной атмосферы для получения правдивых показаний.</li>
          <li><strong>Свободный рассказ</strong> - предоставление возможности допрашиваемому самостоятельно изложить известные ему обстоятельства.</li>
          <li><strong>Постановка вопросов</strong> - уточнение, дополнение и детализация показаний.</li>
          <li><strong>Фиксация показаний</strong> - составление протокола допроса.</li>
        </ol>
        
        <h4>Виды вопросов:</h4>
        <ul>
          <li><strong>Уточняющие</strong> - для конкретизации отдельных обстоятельств</li>
          <li><strong>Дополняющие</strong> - для восполнения пробелов в показаниях</li>
          <li><strong>Напоминающие</strong> - для активизации памяти допрашиваемого</li>
          <li><strong>Контрольные</strong> - для проверки достоверности показаний</li>
        </ul>
        
        <h4>Запрещенные приемы:</h4>
        <ul>
          <li>Задавать наводящие вопросы</li>
          <li>Применять угрозы или насилие</li>
          <li>Обещать какие-либо выгоды в обмен на показания</li>
        </ul>
      `,
    },
    {
      title: "Сбор и анализ улик",
      content: `
        <h3>Методика сбора и анализа вещественных доказательств</h3>
        <p>Вещественные доказательства - это предметы, которые служили орудиями преступления, сохранили на себе следы преступления или были объектами преступных действий.</p>
        
        <h4>Правила обращения с вещественными доказательствами:</h4>
        <ol>
          <li><strong>Минимизация контакта</strong> - использование перчаток, пинцетов и других инструментов для предотвращения загрязнения улик.</li>
          <li><strong>Индивидуальная упаковка</strong> - каждое доказательство должно быть упаковано отдельно для предотвращения перекрестного загрязнения.</li>
          <li><strong>Маркировка</strong> - каждая упаковка должна быть промаркирована с указанием даты, времени, места обнаружения и лица, обнаружившего улику.</li>
          <li><strong>Цепочка хранения</strong> - документирование всех лиц, имевших доступ к доказательству.</li>
        </ol>
        
        <h4>Виды следов:</h4>
        <ul>
          <li><strong>Следы рук</strong> - отпечатки пальцев, ладоней</li>
          <li><strong>Следы ног</strong> - отпечатки обуви, босых ног</li>
          <li><strong>Следы орудий взлома</strong> - царапины, вмятины, отщепы</li>
          <li><strong>Следы транспортных средств</strong> - отпечатки шин, следы ГСМ</li>
          <li><strong>Биологические следы</strong> - кровь, слюна, волосы, частицы кожи</li>
          <li><strong>Микрочастицы</strong> - волокна, пыль, частицы краски</li>
        </ul>
      `,
    },
    {
      title: "Криминалистическая психология",
      content: `
        <h3>Основы криминалистической психологии</h3>
        <p>Криминалистическая психология изучает психологические закономерности преступного поведения и разрабатывает психологические методы расследования преступлений.</p>
        
        <h4>Психологический портрет преступника:</h4>
        <p>Метод, позволяющий на основе анализа следов преступления и поведения преступника составить его психологический профиль, включающий:</p>
        <ul>
          <li>Демографические характеристики (пол, возраст, раса)</li>
          <li>Образование и профессиональные навыки</li>
          <li>Семейное положение и социальный статус</li>
          <li>Психологические особенности (темперамент, характер)</li>
          <li>Мотивы совершения преступления</li>
          <li>Вероятность совершения повторных преступлений</li>
        </ul>
        
        <h4>Психологические приемы допроса:</h4>
        <ul>
          <li><strong>Метод убеждения</strong> - логическое воздействие на допрашиваемого</li>
          <li><strong>Метод изобличения</strong> - предъявление доказательств, опровергающих ложные показания</li>
          <li><strong>Метод рефлексии</strong> - моделирование мыслительных процессов допрашиваемого</li>
          <li><strong>Метод снятия напряжения</strong> - создание благоприятной психологической атмосферы</li>
        </ul>
      `,
    },
  ]

  const scenes = [
    {
      background: "/images/novel/locations/police1.png?height=720&width=1280&text=Полицейский+участок",
      dialogs: [
        { character: null, text: "Полицейский участок, 8:30 утра. Начало нового рабочего дня." },
        { character: "protagonist", text: "Еще один день, еще одно дело. Интересно, что сегодня приготовил капитан?" },
        { character: "captain", text: "Детектив! Зайдите ко мне в кабинет. У нас новое дело." },
        { character: "protagonist", text: "Уже иду, капитан." },
        { character: null, text: "Вы входите в кабинет капитана Волкова. Он выглядит серьезнее обычного." },
        { character: "captain", text: "Сегодня утром обнаружено тело Виктора Новикова, генерального директора 'НовТех'. Убийство произошло в его офисе." },
        { character: "captain", text: "Это громкое дело, и мэр лично звонил мне. Он хочет быстрых результатов." },
        { character: "captain", text: "Вы будете работать с лейтенантом Соколовой. Она уже на месте преступления." },
        { character: "protagonist", text: "Понял, капитан. Выезжаю немедленно." },
        { character: "captain", text: "И еще кое-что. Новиков был непростым человеком. У него много врагов и еще больше секретов. Будьте осторожны." },
        { character: "protagonist", text: "Я буду держать вас в курсе, капитан." },
        { character: null, text: "Вы выходите из кабинета капитана и направляетесь к месту преступления." },
      ],
      choices: null,
      addEvidence: null,
      addNotebookEntry: {
        title: "Новое дело",
        content: "Убийство Виктора Новикова, генерального директора 'НовТех'. Тело обнаружено в его офисе. Капитан предупредил, что у Новикова много врагов и секретов."
      }
    },
    {
      background: "/images/novel/locations/novtech.png?height=720&width=1280&text=Офис+НовТех",
      dialogs: [
        { character: null, text: "Офис компании 'НовТех', 9:15 утра. Место преступления ограждено полицейской лентой." },
        { character: "partner", text: "А, вот и вы. Я уже начала осмотр." },
        { character: "protagonist", text: "Что у нас есть, лейтенант?" },
        { character: "partner", text: "Виктор Новиков, 45 лет. Обнаружен своей секретаршей около 8 утра. Предварительная причина смерти - удар тяжелым предметом по голове." },
        { character: "partner", text: "Судя по всему, смерть наступила вчера вечером, между 19:00 и 21:00. Доктор Морозов сейчас осматривает тело." },
        { character: "protagonist", text: "Есть свидетели?" },
        { character: "partner", text: "Секретарша, Анна Петрова. Она в соседней комнате, дает показания. Говорит, что вчера ушла в 18:30, а Новиков остался работать." },
        { character: "partner", text: "Еще есть охранник, который дежурил вчера вечером. По его словам, около 20:00 к Новикову приходил Игорь Кравцов, его деловой партнер. Они часто спорили в последнее время." },
        { character: "protagonist", text: "Понятно. Давайте осмотрим место преступления." },
        { character: null, text: "Вы начинаете осматривать кабинет. Тело Новикова лежит за рабочим столом. На полу - разбитая статуэтка со следами крови." },
        { character: "forensic", text: "А, детектив! Рад вас видеть. Предварительно могу сказать, что смерть наступила от сильного удара по затылку. Орудие убийства, скорее всего, эта статуэтка." },
        { character: "forensic", text: "Интересная деталь - на руке жертвы есть следы борьбы. Он пытался защититься." },
        { character: "protagonist", text: "Спасибо, доктор. Что-нибудь еще?" },
        { character: "forensic", text: "Да, в крови жертвы обнаружен алкоголь. Судя по всему, он выпивал перед смертью. На столе стоят два бокала." },
        { character: "protagonist", text: "Два бокала? Значит, он был не один." },
        { character: "forensic", text: "Именно. И еще одна деталь - в кармане жертвы найдена записка с цифрами. Похоже на какой-то код или пароль." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Осмотреть рабочий стол Новикова", nextScene: 2 },
          { text: "Поговорить с секретаршей Анной Петровой", nextScene: 3 },
          { text: "Изучить записку с цифрами", nextScene: 4 }
        ]
      },
      addEvidence: ["Окровавленная статуэтка", "Два бокала на столе", "Записка с цифрами"],
      addNotebookEntry: {
        title: "Место преступления",
        content: "Виктор Новиков убит ударом по голове, предположительно статуэткой. Время смерти - между 19:00 и 21:00. На столе два бокала - жертва была не одна. В кармане найдена записка с цифрами. Последним посетителем был Игорь Кравцов, деловой партнер."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Рабочий+стол",
      dialogs: [
        { character: null, text: "Вы внимательно осматриваете рабочий стол Новикова." },
        { character: "protagonist", text: "Так, что у нас тут..." },
        { character: "protagonist", text: "Компьютер включен, но заблокирован паролем. Нужно будет запросить доступ у IT-отдела." },
        { character: "protagonist", text: "Интересно... В ежедневнике запись на вчерашний вечер: 'И.К. 19:30 - обсудить контракт'." },
        { character: "protagonist", text: "И.К. - должно быть, Игорь Кравцов." },
        { character: "partner", text: "Смотрите, в ящике стола - папка с документами по сделке с 'КравцИнвест'. Это компания Кравцова." },
        { character: "protagonist", text: "Дайте взглянуть... Похоже, Новиков собирался разорвать контракт. Здесь черновик письма о расторжении." },
        { character: "partner", text: "Это может быть мотивом. Если сделка была важна для Кравцова, он мог пойти на крайние меры." },
        { character: "protagonist", text: "Возможно. Нужно поговорить с Кравцовым." },
        { character: "partner", text: "Я уже отправила патруль к нему домой. Пока его не нашли." },
        { character: "protagonist", text: "Хорошо. Давайте продолжим осмотр." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Поговорить с секретаршей Анной Петровой", nextScene: 3 },
          { text: "Изучить записку с цифрами", nextScene: 4 },
          { text: "Проверить камеры наблюдения", nextScene: 5 }
        ]
      },
      addEvidence: ["Ежедневник с записью 'И.К. 19:30'", "Документы о расторжении контракта"],
      addNotebookEntry: {
        title: "Рабочий стол Новикова",
        content: "В ежедневнике запись о встрече с И.К. (Игорь Кравцов) в 19:30. Найдены документы о планируемом расторжении контракта с компанией Кравцова. Возможный мотив для убийства."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Комната+отдыха",
      dialogs: [
        { character: null, text: "Вы находите Анну Петрову в комнате отдыха. Она выглядит потрясенной." },
        { character: "protagonist", text: "Мисс Петрова? Я детектив из отдела особо важных дел. Могу я задать вам несколько вопросов?" },
        { character: "witness", text: "Да, конечно... Я все еще не могу поверить, что это произошло." },
        { character: "protagonist", text: "Расскажите, пожалуйста, что произошло сегодня утром." },
        { character: "witness", text: "Я пришла на работу как обычно, около 8 утра. Дверь в кабинет Виктора Михайловича была приоткрыта, что странно - он всегда закрывал ее." },
        { character: "witness", text: "Я заглянула внутрь и... увидела его... на полу... в крови..." },
        { character: "protagonist", text: "Понимаю, это тяжело. А вчера вечером? Когда вы ушли с работы?" },
        { character: "witness", text: "Около 18:30. Виктор Михайлович сказал, что у него назначена встреча, и я могу идти домой." },
        { character: "protagonist", text: "Он сказал, с кем встреча?" },
        { character: "witness", text: "Нет, но я видела в его ежедневнике запись. Что-то про Игоря Кравцова." },
        { character: "protagonist", text: "Как бы вы описали отношения между Новиковым и Кравцовым?" },
        { character: "witness", text: "Напряженные. Они были партнерами, но в последнее время часто спорили. Виктор Михайлович говорил, что Кравцов его подводит." },
        { character: "protagonist", text: "Вы знаете, о чем конкретно они спорили?" },
        { character: "witness", text: "О каком-то контракте. Виктор Михайлович считал, что Кравцов не выполняет свои обязательства." },
        { character: "protagonist", text: "Кто еще мог иметь мотив для убийства Новикова?" },
        { character: "witness", text: "Ну... Была еще Елена, его бывшая жена. Они недавно развелись, и она требовала большую компенсацию. И еще Сергей Васнецов, конкурент. Их компании боролись за крупный государственный контракт." },
      ],
      choices: {
        question: "Какой вопрос вы хотите задать Анне?",
        options: [
          { text: "Спросить о личной жизни Новикова", nextScene: 6 },
          { text: "Узнать больше о Елене, бывшей жене", nextScene: 7 },
          { text: "Расспросить о Сергее Васнецове", nextScene: 8 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Показания Анны Петровой",
        content: "Анна обнаружила тело около 8 утра. Ушла с работы вчера в 18:30, Новиков остался ждать встречи. Отношения между Новиковым и Кравцовым были напряженными из-за контракта. Другие возможные подозреваемые: Елена (бывшая жена) и Сергей Васнецов (конкурент)."
      }
    },
    {
      background: "/images/novel/note.png?height=720&width=1280&text=Офис+НовТех+-+Записка",
      dialogs: [
        { character: null, text: "Вы внимательно изучаете записку, найденную в кармане Новикова." },
        { character: "protagonist", text: "Так, что тут у нас... '7-3-9-2-5'. Похоже на код от сейфа или пароль." },
        { character: "partner", text: "В кабинете есть сейф?" },
        { character: "protagonist", text: "Давайте поищем." },
        { character: null, text: "После короткого поиска вы обнаруживаете небольшой сейф за картиной." },
        { character: "protagonist", text: "Вот он. Попробуем код из записки." },
        { character: null, text: "Вы вводите код 7-3-9-2-5. Сейф открывается." },
        { character: "protagonist", text: "Бинго! Посмотрим, что внутри..." },
        { character: "protagonist", text: "Здесь флешка и... интересно, папка с фотографиями." },
        { character: "partner", text: "Что на фотографиях?" },
        { character: "protagonist", text: "Похоже на компромат. Здесь Кравцов встречается с каким-то человеком... Судя по обстановке, это не деловая встреча." },
        { character: "partner", text: "Этот человек... Разве это не Михаил Зотов, глава комитета по распределению госконтрактов?" },
        { character: "protagonist", text: "Точно! А вот и конверт с деньгами переходит из рук в руки. Похоже на взятку." },
        { character: "partner", text: "Если Новиков собирался использовать эти фото против Кравцова..." },
        { character: "protagonist", text: "То у Кравцова был очень серьезный мотив заставить его замолчать." },
      ],
      choices: {
        question: "Что вы хотите сделать с найденными уликами?",
        options: [
          { text: "Изучить флешку на компьютере", nextScene: 9 },
          { text: "Показать фотографии капитану", nextScene: 10 },
          { text: "Допросить Кравцова с этими уликами", nextScene: 11 }
        ]
      },
      addEvidence: ["Флешка из сейфа", "Компрометирующие фотографии Кравцова и Зотова"],
      addNotebookEntry: {
        title: "Содержимое сейфа",
        content: "В сейфе обнаружены флешка и фотографии, на которых Кравцов передает взятку Михаилу Зотову, главе комитета по распределению госконтрактов. Новиков мог шантажировать Кравцова этими фото."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Камеры+наблюдения",
      dialogs: [
        { character: null, text: "Вы направляетесь в комнату охраны, чтобы проверить записи с камер наблюдения." },
        { character: "protagonist", text: "Здравствуйте. Мне нужны записи с камер за вчерашний вечер, примерно с 19:00 до 21:00." },
        { character: null, text: "Охранник кивает и показывает вам систему видеонаблюдения." },
        { character: null, text: "Вы просматриваете записи и видите, как Игорь Кравцов входит в здание в 19:25 и направляется в кабинет Новикова." },
        { character: "protagonist", text: "Вот он. Точно по расписанию." },
        { character: "partner", text: "А вот и выходит... в 20:15. Выглядит взволнованным." },
        { character: "protagonist", text: "Да, и обратите внимание на его правую руку - он держит ее странно, как будто поранился." },
        { character: "partner", text: "Возможно, во время борьбы с Новиковым?" },
        { character: "protagonist", text: "Вполне вероятно. Кто-нибудь еще входил или выходил в это время?" },
        { character: null, text: "Вы продолжаете просматривать записи и замечаете еще одного посетителя." },
        { character: "protagonist", text: "Стоп. Кто это входит в 20:30?" },
        { character: "partner", text: "Похоже на женщину... Трудно разглядеть лицо, она в капюшоне." },
        { character: "protagonist", text: "И выходит она... в 20:50. Тоже выглядит взволнованной." },
        { character: "partner", text: "Может быть, это Елена, бывшая жена Новикова?" },
        { character: "protagonist", text: "Возможно. Нужно будет проверить. А что с охранником, который дежурил вчера?" },
        { character: null, text: "Охранник указывает на своего коллегу, который сидит в углу комнаты." },
        { character: "protagonist", text: "Вы дежурили вчера вечером? Можете рассказать, что видели?" },
        { character: null, text: "Охранник кивает и начинает рассказывать." },
        { character: null, text: "По его словам, Кравцов пришел на встречу, как и было запланировано. Через некоторое время из кабинета Новикова были слышны громкие голоса, похоже на спор." },
        { character: null, text: "Когда Кравцов уходил, он выглядел рассерженным. А женщина в капюшоне представилась как курьер, сказала, что несет срочные документы для Новикова." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Допросить Игоря Кравцова", nextScene: 11 },
          { text: "Найти и поговорить с Еленой, бывшей женой", nextScene: 12 },
          { text: "Вернуться к осмотру места преступления", nextScene: 13 }
        ]
      },
      addEvidence: ["Видеозапись с Кравцовым", "Видеозапись с неизвестной женщиной"],
      addNotebookEntry: {
        title: "Записи с камер наблюдения",
        content: "Кравцов пришел в 19:25 и ушел в 20:15, выглядел взволнованным, возможно поранил руку. После него в 20:30 приходила женщина в капюшоне, представилась курьером. Охранник слышал спор из кабинета Новикова во время визита Кравцова."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Комната+отдыха",
      dialogs: [
        { character: "protagonist", text: "Мисс Петрова, расскажите, пожалуйста, о личной жизни Виктора Новикова." },
        { character: "witness", text: "Ну... Он недавно развелся с женой, Еленой. Брак распался около полугода назад." },
        { character: "witness", text: "Виктор Михайлович не любил говорить об этом, но я знаю, что развод был тяжелым. Елена требовала половину компании." },
        { character: "protagonist", text: "Они поддерживали контакт после развода?" },
        { character: "witness", text: "Да, и не всегда мирно. Она несколько раз приходила сюда, они спорили. В последний раз это было неделю назад." },
        { character: "protagonist", text: "О чем был спор?" },
        { character: "witness", text: "Я точно не знаю, но слышала, как Виктор Михайлович говорил что-то о том, что она не получит ни копейки больше." },
        { character: "protagonist", text: "У Новикова были отношения с кем-то еще?" },
        { character: "witness", text: "В последнее время он часто встречался с Мариной Соловьевой, она работает в юридическом отделе. Но это не афишировалось." },
        { character: "protagonist", text: "Понятно. А что насчет врагов? Кто мог желать ему зла?" },
        { character: "witness", text: "Кроме Кравцова и бывшей жены? Ну, у него был конфликт с Сергеем Васнецовым, главой 'ТехноПрогресс'. Они конкурировали за крупный контракт." },
        { character: "witness", text: "И еще... Виктор Михайлович недавно уволил своего заместителя, Андрея Климова. Тот угрожал 'раскрыть все его грязные секреты'." },
      ],
      choices: {
        question: "О ком вы хотите узнать больше?",
        options: [
          { text: "О Елене, бывшей жене Новикова", nextScene: 7 },
          { text: "О Марине Соловьевой из юридического отдела", nextScene: 14 },
          { text: "Об Андрее Климове, уволенном заместителе", nextScene: 15 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Личная жизнь Новикова",
        content: "Недавно развелся с Еленой, которая требовала половину компании. Встречался с Мариной Соловьевой из юридического отдела. Уволил заместителя Андрея Климова, который угрожал раскрыть какие-то секреты."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Комната+отдыха",
      dialogs: [
        { character: "protagonist", text: "Расскажите подробнее о Елене, бывшей жене Новикова." },
        { character: "witness", text: "Елена Новикова... или теперь снова Орлова, ее девичья фамилия. Они были женаты 15 лет." },
        { character: "witness", text: "Она всегда была очень амбициозной. Говорят, в начале карьеры она сильно помогала Виктору Михайловичу с бизнесом." },
        { character: "protagonist", text: "Почему они развелись?" },
        { character: "witness", text: "Официально - из-за 'непримиримых разногласий'. Но по офису ходили слухи, что Виктор Михайлович ей изменял." },
        { character: "witness", text: "Елена была в ярости, когда узнала. Требовала 50% акций компании при разводе." },
        { character: "protagonist", text: "И что в итоге?" },
        { character: "witness", text: "Суд присудил ей гораздо меньше, чем она хотела. Виктор Михайлович нанял очень хороших адвокатов." },
        { character: "witness", text: "Она приходила сюда неделю назад, они сильно спорили. Я слышала, как она кричала, что он еще пожалеет." },
        { character: "protagonist", text: "Вы знаете, где сейчас Елена?" },
        { character: "witness", text: "Она открыла свой бизнес - дизайнерское агентство. Но дела идут не очень хорошо, насколько я знаю." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Расспросить о Сергее Васнецове", nextScene: 8 },
          { text: "Узнать больше о Марине Соловьевой", nextScene: 14 },
          { text: "Найти и допросить Елену Орлову", nextScene: 12 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Елена Орлова (бывшая Новикова)",
        content: "Бывшая жена Новикова, были женаты 15 лет. При разводе требовала 50% компании, но получила меньше. Недавно угрожала Новикову. Сейчас владеет дизайнерским агентством, которое испытывает финансовые трудности."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Комната+отдыха",
      dialogs: [
        { character: "protagonist", text: "А что вы можете рассказать о Сергее Васнецове?" },
        { character: "witness", text: "Сергей Васнецов - глава 'ТехноПрогресс', основного конкурента 'НовТех'." },
        { character: "witness", text: "Они с Виктором Михайловичем знают друг друга еще со студенческих времен. Раньше даже дружили, но потом стали конкурентами." },
        { character: "protagonist", text: "Насколько серьезным был их конфликт?" },
        { character: "witness", text: "Очень серьезным. Сейчас они боролись за государственный контракт на 500 миллионов рублей. Виктор Михайлович был уверен, что выиграет." },
        { character: "witness", text: "Но недавно он узнал, что Васнецов каким-то образом получил доступ к коммерческому предложению 'НовТех' и изменил свое, чтобы оно было более выгодным." },
        { character: "protagonist", text: "То есть, промышленный шпионаж?" },
        { character: "witness", text: "Да, Виктор Михайлович был в ярости. Он собирался подать официальную жалобу в антимонопольную службу." },
        { character: "protagonist", text: "Когда должно было быть объявлено решение по контракту?" },
        { character: "witness", text: "Сегодня. Ирония судьбы, правда?" },
        { character: "protagonist", text: "Васнецов знал о планах Новикова подать жалобу?" },
        { character: "witness", text: "Да, Виктор Михайлович лично звонил ему два дня назад. Я слышала этот разговор - он был очень напряженным." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Узнать больше о Марине Соловьевой", nextScene: 14 },
          { text: "Расспросить об Андрее Климове", nextScene: 15 },
          { text: "Организовать встречу с Сергеем Васнецовым", nextScene: 16 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Сергей Васнецов",
        content: "Глава конкурирующей компании 'ТехноПрогресс'. Бывший друг Новикова. Они боролись за контракт на 500 млн рублей. Новиков обвинял его в промышленном шпионаже и собирался подать жалобу. Решение по контракту должно было быть объявлено сегодня."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Компьютер",
      dialogs: [
        { character: null, text: "Вы подключаете флешку к компьютеру и просматриваете ее содержимое." },
        { character: "protagonist", text: "Так, что тут у нас..." },
        { character: "protagonist", text: "Интересно. Здесь финансовые отчеты 'КравцИнвест' за последние три года." },
        { character: "partner", text: "И что в них необычного?" },
        { character: "protagonist", text: "Судя по этим цифрам, компания Кравцова на грани банкротства. Они держатся на плаву только благодаря контракту с 'НовТех'." },
        { character: "partner", text: "Если Новиков собирался разорвать контракт..." },
        { character: "protagonist", text: "То Кравцов потерял бы все. Очень сильный мотив." },
        { character: "protagonist", text: "А вот еще что-то интересное - переписка Новикова с каким-то анонимным информатором." },
        { character: "partner", text: "О чем она?" },
        { character: "protagonist", text: "Информатор сообщает, что Кравцов и Зотов планируют какую-то крупную аферу с государственными контрактами." },
        { character: "protagonist", text: "И судя по датам, Новиков получил эту информацию за день до убийства." },
        { character: "partner", text: "Возможно, он пригласил Кравцова, чтобы confronted him with this information." },
        { character: "protagonist", text: "Exactly. Он мог шантажировать Кравцова фотографиями и этой перепиской." },
        { character: "partner", text: "Кравцов мог решить, что единственный способ спасти себя - заставить Новикова замолчать навсегда." },
        { character: "protagonist", text: "Нужно срочно найти Кравцова." },
      ],
      choices: {
        question: "Что вы хотите сделать с полученной информацией?",
        options: [
          { text: "Доложить капитану и получить ордер на арест Кравцова", nextScene: 17 },
          { text: "Лично допросить Кравцова с этими уликами", nextScene: 11 },
          { text: "Проверить алиби других подозреваемых", nextScene: 18 }
        ]
      },
      addEvidence: ["Финансовые отчеты 'КравцИнвест'", "Переписка с анонимным информатором"],
      addNotebookEntry: {
        title: "Содержимое флешки",
        content: "Финансовые отчеты показывают, что компания Кравцова на грани банкротства и зависит от контракта с 'НовТех'. Также найдена переписка с анонимным информатором о готовящейся афере Кравцова и Зотова. Новиков получил эту информацию за день до убийства."
      }
    },
    {
      background: "/images/novel/locations/volkov_office.png?height=720&width=1280&text=Полицейский+участок+-+Кабинет+капитана",
      dialogs: [
        { character: null, text: "Вы возвращаетесь в участок и показываете капитану Волкову найденные фотографии." },
        { character: "captain", text: "Так-так, что у вас тут?" },
        { character: "protagonist", text: "Фотографии из сейфа Новикова. На них Игорь Кравцов передает взятку Михаилу Зотову, главе комитета по госконтрактам." },
        { character: "captain", text: "Черт возьми! Это серьезно. Если Новиков собирался использовать эти фото..." },
        { character: "protagonist", text: "То у Кравцова был очень веский мотив заставить его замолчать. К тому же, мы проверили камеры наблюдения - Кравцов был последним, кто видел Новикова живым." },
        { character: "captain", text: "Что еще у вас есть?" },
        { character: "protagonist", text: "Свидетельские показания о том, что между Новиковым и Кравцовым был конфликт из-за контракта. Новиков собирался разорвать деловые отношения." },
        { character: "protagonist", text: "А финансовые отчеты показывают, что без этого контракта компания Кравцова обанкротилась бы." },
        { character: "captain", text: "Хорошая работа. Я выпишу ордер на арест Кравцова. Но не расслабляйтесь - нам нужны неопровержимые доказательства для суда." },
        { character: "protagonist", text: "Есть еще кое-что. После Кравцова в офис приходила какая-то женщина. Возможно, это Елена Орлова, бывшая жена Новикова." },
        { character: "captain", text: "Проверьте и ее тоже. В таких делах нельзя исключать никого." },
        { character: "protagonist", text: "Будет сделано, капитан." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Арестовать Игоря Кравцова", nextScene: 19 },
          { text: "Найти и допросить Елену Орлову", nextScene: 12 },
          { text: "Проверить алиби Сергея Васнецова", nextScene: 16 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Доклад капитану",
        content: "Капитан выписал ордер на арест Кравцова на основании найденных улик. Нужно продолжить расследование, чтобы собрать неопровержимые доказательства для суда. Также следует проверить причастность Елены Орловой."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+Кравцова",
      dialogs: [
        { character: null, text: "Вы находите Игоря Кравцова в его офисе. Он выглядит напряженным, но старается сохранять спокойствие." },
        { character: "protagonist", text: "Игорь Кравцов? Я детектив из отдела особо важных дел. Мне нужно задать вам несколько вопросов об убийстве Виктора Новикова." },
        { character: "suspect", text: "Я уже слышал о случившемся. Ужасная трагедия. Чем могу помочь?" },
        { character: "protagonist", text: "Где вы были вчера вечером между 19:00 и 21:00?" },
        { character: "suspect", text: "У меня была встреча с Виктором в его офисе около 19:30. Мы обсуждали наш контракт." },
        { character: "protagonist", text: "И как прошла встреча?" },
        { character: "suspect", text: "Нормально. У нас были некоторые разногласия, но мы всё обсудили как цивилизованные люди." },
        { character: "protagonist", text: "Разногласия? Какого рода?" },
        { character: "suspect", text: "Виктор был недоволен некоторыми аспектами нашего сотрудничества. Но мы пришли к компромиссу." },
        { character: "protagonist", text: "Странно, потому что у нас есть документы, показывающие, что Новиков собирался разорвать контракт с вашей компанией." },
        { character: "suspect", text: "Что? Нет, это какая-то ошибка. Мы договорились продолжить сотрудничество." },
        { character: "protagonist", text: "Камеры наблюдения показывают, что вы покинули здание в 20:15 и выглядели очень взволнованным." },
        { character: "suspect", text: "Я... я спешил на другую встречу. И да, наш разговор с Виктором был напряженным, но мы всё решили." },
        { character: "protagonist", text: "Что с вашей рукой? Вы поранились?" },
        { character: "suspect", text: "Это? Порезался, когда готовил ужин. Ничего серьезного." },
        { character: "protagonist", text: "Игорь, мы знаем о ваших финансовых проблемах. Без контракта с 'НовТех' ваша компания обанкротилась бы." },
        { character: "suspect", text: "Это... это преувеличение. У нас есть и другие клиенты." },
        { character: "protagonist", text: "А как насчет этого?" },
      ],
      choices: {
        question: "Какую улику вы хотите предъявить Кравцову?",
        options: [
          { text: "Показать фотографии с Зотовым", nextScene: 20 },
          { text: "Предъявить финансовые отчеты", nextScene: 21 },
          { text: "Показать записку с цифрами", nextScene: 22 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Допрос Кравцова",
        content: "Кравцов признал, что встречался с Новиковым в вечер убийства. Утверждает, что они пришли к компромиссу, хотя документы говорят об обратном. Поранил руку, но утверждает, что это бытовая травма. Отрицает серьезность финансовых проблем своей компании."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Квартира+Елены+Орловой",
      dialogs: [
        { character: null, text: "Вы находите Елену Орлову в ее квартире. Она выглядит удивленной вашим визитом." },
        { character: "protagonist", text: "Елена Орлова? Я детектив из отдела особо важных дел. Мне нужно поговорить с вами о Викторе Новикове." },
        { character: null, text: "Елена напрягается при упоминании имени бывшего мужа." },
        { character: null, text: "Елена: 'Что с ним? Опять какие-то претензии?'" },
        { character: "protagonist", text: "Мне жаль сообщить, но Виктор Новиков был убит вчера вечером в своем офисе." },
        { character: null, text: "Елена выглядит шокированной. Она опускается на диван, ее руки слегка дрожат." },
        { character: null, text: "Елена: 'Убит? Не могу поверить... Кто это сделал?'" },
        { character: "protagonist", text: "Мы выясняем. Где вы были вчера вечером между 19:00 и 21:00?" },
        { character: null, text: "Елена: 'Я была дома, работала над проектом для клиента. Я дизайнер интерьеров.'" },
        { character: "protagonist", text: "Кто-нибудь может подтвердить ваше алиби?" },
        { character: null, text: "Елена: 'Я была одна. Но у меня есть записи времени работы в программе дизайна. И я заказывала еду с доставкой около восьми вечера.'" },
        { character: "protagonist", text: "Мы знаем, что у вас был конфликт с бывшим мужем из-за раздела имущества при разводе." },
        { character: null, text: "Елена: 'Да, это правда. Виктор обманул меня. Я помогала ему строить бизнес с нуля, а при разводе он нанял армию адвокатов, чтобы я получила как можно меньше.'" },
        { character: "protagonist", text: "Вы угрожали ему неделю назад в его офисе?" },
        { character: null, text: "Елена: 'Я была расстроена. Сказала что-то вроде 'ты еще пожалеешь'. Но это были просто слова, я никогда бы не причинила ему вред.'" },
        { character: "protagonist", text: "Вы приходили в офис 'НовТех' вчера вечером?" },
        { character: null, text: "Елена заметно нервничает." },
        { character: null, text: "Елена: 'Нет, с чего вы взяли?'" },
        { character: "protagonist", text: "У нас есть записи с камер наблюдения. Женщина, похожая на вас, входила в здание в 20:30." },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Надавить на Елену, чтобы она призналась", nextScene: 23 },
          { text: "Спросить о ее отношениях с Кравцовым", nextScene: 24 },
          { text: "Поинтересоваться финансовым положением ее бизнеса", nextScene: 25 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Допрос Елены Орловой",
        content: "Елена утверждает, что была дома во время убийства, но ее алиби нельзя проверить. Признает конфликт с Новиковым из-за развода и то, что угрожала ему. Отрицает, что приходила в офис вечером убийства, хотя камеры зафиксировали похожую женщину."
      }
    },
    {
      background: "/images/novel/locations/crimeplace.png?height=720&width=1280&text=Офис+НовТех+-+Место+преступления",
      dialogs: [
        { character: null, text: "Вы возвращаетесь на место преступления для более тщательного осмотра." },
        { character: "protagonist", text: "Давайте еще раз внимательно осмотрим все. Мы могли что-то упустить." },
        { character: "partner", text: "Что конкретно вы ищете?" },
        { character: "protagonist", text: "Любую мелочь, которая может указать на убийцу." },
        { character: null, text: "Вы начинаете методичный осмотр кабинета, обращая внимание на детали, которые могли пропустить ранее." },
        { character: "protagonist", text: "Интересно... Смотрите, под столом." },
        { character: "partner", text: "Что там?" },
        { character: "protagonist", text: "Запонка. Дорогая, судя по виду." },
        { character: "partner", text: "Она могла принадлежать Новикову?" },
        { character: "protagonist", text: "Возможно. Но также могла принадлежать и убийце. Упала во время борьбы." },
        { character: "protagonist", text: "А вот еще что-то... В щели дивана." },
        { character: "partner", text: "Похоже на чек из ресторана." },
        { character: "protagonist", text: "Да, от вчерашнего вечера. Ресторан 'Метрополь', 18:45. Два человека." },
        { character: "partner", text: "Новиков ужинал с кем-то перед смертью?" },
        { character: "protagonist", text: "Похоже на то. И судя по сумме, это был не деловой ужин." },
        { character: "partner", text: "Может быть, с Мариной Соловьевой? Секретарша упоминала, что у них были отношения." },
        { character: "protagonist", text: "Возможно. Нужно будет проверить." },
      ],
      choices: {
        question: "Что вы хотите сделать с новыми уликами?",
        options: [
          { text: "Проверить запонку на отпечатки и ДНК", nextScene: 26 },
          { text: "Посетить ресторан 'Метрополь' и опросить персонал", nextScene: 27 },
          { text: "Найти и допросить Марину Соловьеву", nextScene: 14 }
        ]
      },
      addEvidence: ["Запонка, найденная под столом", "Чек из ресторана 'Метрополь'"],
      addNotebookEntry: {
        title: "Дополнительный осмотр места преступления",
        content: "Найдена дорогая запонка под столом - возможно, принадлежала убийце. Также обнаружен чек из ресторана 'Метрополь' от вчерашнего вечера на двоих. Новиков ужинал с кем-то незадолго до смерти."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Юридический+отдел",
      dialogs: [
        { character: null, text: "Вы находите Марину Соловьеву в юридическом отделе. Она выглядит расстроенной новостью о смерти Новикова." },
        { character: "protagonist", text: "Марина Соловьева? Я детектив из отдела особо важных дел. Мне нужно задать вам несколько вопросов о Викторе Новикове." },
        { character: null, text: "Марина: 'Конечно, я постараюсь помочь. Это ужасно, что случилось с Виктором Михайловичем.'" },
        { character: "protagonist", text: "Я понимаю, что вы были близки с Новиковым." },
        { character: null, text: "Марина слегка краснеет." },
        { character: null, text: "Марина: 'Мы... да, у нас были отношения. Мы старались не афишировать это в офисе.'" },
        { character: "protagonist", text: "Когда вы видели его в последний раз?" },
        { character: null, text: "Марина: 'Вчера вечером. Мы ужинали в ресторане 'Метрополь' около семи вечера.'" },
        { character: "protagonist", text: "И как долго продлился ужин?" },
        { character: null, text: "Марина: 'Около часа. Виктор был немного рассеян, сказал, что у него важная встреча в офисе в 19:30.'" },
        { character: "protagonist", text: "Он упоминал, с кем встреча?" },
        { character: null, text: "Марина: 'С Игорем Кравцовым. Виктор был очень напряжен из-за этого. Сказал, что собирается 'положить конец их сотрудничеству'.'" },
        { character: "protagonist", text: "Вы знали о конфликте между ними?" },
        { character: null, text: "Марина: 'Да, Виктор рассказывал мне. Он обнаружил, что Кравцов замешан в коррупционной схеме с госконтрактами. У него были доказательства.'" },
        { character: "protagonist", text: "Какие именно доказательства?" },
        { character: null, text: "Марина: 'Фотографии, показывающие, как Кравцов передает взятку какому-то чиновнику. И еще финансовые документы, доказывающие махинации.'" },
        { character: "protagonist", text: "Новиков говорил, что собирается делать с этими доказательствами?" },
        { character: null, text: "Марина: 'Он хотел использовать их, чтобы заставить Кравцова выйти из совместного проекта без скандала. Сказал, что даст ему шанс уйти по-хорошему.'" },
      ],
      choices: {
        question: "Что вы хотите спросить у Марины?",
        options: [
          { text: "О ее отношениях с Еленой Орловой", nextScene: 28 },
          { text: "Знала ли она о других врагах Новикова", nextScene: 29 },
          { text: "О ее собственном алиби на время убийства", nextScene: 30 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Показания Марины Соловьевой",
        content: "Подтвердила романтические отношения с Новиковым. Ужинала с ним в 'Метрополе' вчера вечером до 19:00. Новиков рассказывал ей о доказательствах против Кравцова и планировал использовать их, чтобы заставить его выйти из совместного проекта."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Кабинет+Климова",
      dialogs: [
        { character: null, text: "Вы находите бывший кабинет Андрея Климова, который теперь занимает другой сотрудник." },
        { character: "protagonist", text: "Извините за беспокойство. Я ищу информацию об Андрее Климове, который раньше работал здесь." },
        { character: null, text: "Сотрудник: 'Климов? Его уволили около месяца назад. Большой скандал был.'" },
        { character: "protagonist", text: "Можете рассказать подробнее?" },
        { character: null, text: "Сотрудник: 'Новиков обвинил его в передаче конфиденциальной информации конкурентам. Что-то связанное с проектом для государственного тендера.'" },
        { character: "protagonist", text: "Как отреагировал Климов?" },
        { character: null, text: "Сотрудник: 'Он всё отрицал, кричал, что Новиков сам нечист на руку. Угрожал раскрыть какие-то секреты компании.'" },
        { character: "protagonist", text: "Вы знаете, где сейчас Климов?" },
        { character: null, text: "Сотрудник: 'Насколько я слышал, он устроился в 'ТехноПрогресс' - к Васнецову. Ирония, правда?'" },
        { character: "protagonist", text: "Очень интересно. А что за секреты компании он угрожал раскрыть?" },
        { character: null, text: "Сотрудник: 'Точно не знаю, но ходили слухи, что Новиков не всегда вел бизнес чисто. Особенно в начале карьеры.'" },
        { character: "protagonist", text: "Спасибо за информацию. Еще один вопрос - Климов и Новиков были в хороших отношениях до этого инцидента?" },
        { character: null, text: "Сотрудник: 'Да, они были почти друзьями. Климов работал с Новиковым с основания компании. Поэтому увольнение было таким шоком для всех.'" },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Найти и допросить Андрея Климова", nextScene: 31 },
          { text: "Проверить связь между Климовым и Васнецовым", nextScene: 16 },
          { text: "Вернуться к допросу Кравцова", nextScene: 11 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Информация об Андрее Климове",
        content: "Бывший заместитель Новикова, уволен месяц назад за предполагаемую передачу информации конкурентам. Угрожал раскрыть 'секреты' компании. Сейчас работает на Васнецова в 'ТехноПрогресс'. Раньше был близким другом Новикова."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+Васнецова",
      dialogs: [
        { character: null, text: "Вы приезжаете в офис 'ТехноПрогресс' для встречи с Сергеем Васнецовым." },
        { character: "protagonist", text: "Сергей Васнецов? Я детектив из отдела особо важных дел. Мне нужно поговорить с вами о Викторе Новикове." },
        { character: null, text: "Васнецов: 'Я уже слышал о случившемся. Ужасная трагедия, хотя мы с Виктором и были конкурентами.'" },
        { character: "protagonist", text: "Расскажите о ваших отношениях с Новиковым." },
        { character: null, text: "Васнецов: 'Мы учились вместе в университете, даже дружили когда-то. Потом оба занялись бизнесом в одной сфере и стали конкурентами.'" },
        { character: "protagonist", text: "Насколько острой была конкуренция?" },
        { character: null, text: "Васнецов: 'Бизнес есть бизнес. Мы боролись за одни и те же контракты, но я всегда уважал Виктора как профессионала.'" },
        { character: "protagonist", text: "Мы знаем о вашем конфликте из-за государственного контракта на 500 миллионов рублей." },
        { character: null, text: "Васнецов слегка напрягается." },
        { character: null, text: "Васнецов: 'Да, мы оба претендовали на этот контракт. Это нормальная конкуренция.'" },
        { character: "protagonist", text: "Новиков обвинял вас в промышленном шпионаже. В том, что вы получили доступ к его коммерческому предложению." },
        { character: null, text: "Васнецов: 'Это абсурд. Виктор всегда был параноиком. Я выиграл этот тендер честно.'" },
        { character: "protagonist", text: "Вы знали, что Новиков собирался подать официальную жалобу в антимонопольную службу?" },
        { character: null, text: "Васнецов: 'Он угрожал этим, да. Звонил мне пару дней назад, кричал в трубку. Но это были пустые угрозы.'" },
        { character: "protagonist", text: "Где вы были вчера вечером между 19:00 и 21:00?" },
        { character: null, text: "Васнецов: 'На деловом ужине с потенциальными инвесторами. В ресторане 'Белуга'. Там было около десяти человек, все могут подтвердить.'" },
      ],
      choices: {
        question: "Что вы хотите спросить у Васнецова?",
        options: [
          { text: "О его отношениях с Андреем Климовым", nextScene: 32 },
          { text: "О его знакомстве с Игорем Кравцовым", nextScene: 33 },
          { text: "О результатах тендера на госконтракт", nextScene: 34 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Допрос Сергея Васнецова",
        content: "Бывший друг Новикова, ставший конкурентом. Отрицает обвинения в промышленном шпионаже. Знал о планах Новикова подать жалобу, но считал это пустыми угрозами. Имеет алиби на время убийства - деловой ужин в ресторане 'Белуга' с множеством свидетелей."
      }
    },
    {
      background: "/images/novel/locations/police1.png?height=720&width=1280&text=Полицейский+участок",
      dialogs: [
        { character: null, text: "Вы возвращаетесь в участок с ордером на арест Игоря Кравцова." },
        { character: "protagonist", text: "Отправляемся за Кравцовым. У нас достаточно улик для ареста." },
        { character: "partner", text: "Патрульные уже окружили его офис. Он никуда не денется." },
        { character: null, text: "Вы прибываете в офис Кравцова вместе с группой захвата." },
        { character: "protagonist", text: "Игорь Кравцов, вы арестованы по подозрению в убийстве Виктора Новикова." },
        { character: "suspect", text: "Это какая-то ошибка! Я не убивал Виктора!" },
        { character: "protagonist", text: "У нас есть доказательства вашего присутствия на месте преступления в момент убийства, мотив и следы борьбы на вашей руке." },
        { character: "suspect", text: "Да, я был там! Мы поспорили, даже немного потолкались, но когда я уходил, он был жив! Клянусь!" },
        { character: "protagonist", text: "Расскажите, что произошло." },
        { character: "suspect", text: "Виктор шантажировал меня. У него были фотографии, компрометирующие меня и Зотова. Он угрожал передать их в прокуратуру, если я не выйду из совместного проекта." },
        { character: "suspect", text: "Я разозлился, мы поругались. Я схватил его за грудки, он оттолкнул меня, я упал и поранил руку о край стола. Но потом мы немного успокоились." },
        { character: "suspect", text: "Я согласился на его условия - что еще мне оставалось? И ушел около 20:15. Он был жив, клянусь вам!" },
        { character: "protagonist", text: "Если не вы, то кто мог убить Новикова?" },
        { character: "suspect", text: "Не знаю... Может, Васнецов? Они конкурировали за крупный контракт. Или его бывшая жена - она ненавидела его после развода." },
        { character: "protagonist", text: "Вы видели кого-нибудь, когда уходили из офиса?" },
        { character: "suspect", text: "Нет... Хотя, постойте. Я видел женщину в холле, она ждала лифт. Кажется, это была Елена, бывшая жена Виктора. Но я не уверен, она была в капюшоне." },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Проверить алиби Елены Орловой еще раз", nextScene: 35 },
          { text: "Допросить охранника о женщине в капюшоне", nextScene: 36 },
          { text: "Проверить записи камер наблюдения в холле", nextScene: 37 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Арест и показания Кравцова",
        content: "Кравцов арестован, но отрицает убийство. Признает, что был в офисе Новикова, поругался с ним и даже была небольшая потасовка. Утверждает, что ушел в 20:15, и Новиков был жив. Упомянул, что видел в холле женщину, похожую на Елену Орлову."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+Кравцова",
      dialogs: [
        { character: "protagonist", text: "Игорь, я хочу показать вам кое-что." },
        { character: null, text: "Вы достаете фотографии, на которых Кравцов передает конверт Зотову." },
        { character: "suspect", text: "Откуда у вас... Это те самые фотографии, которыми шантажировал меня Виктор." },
        { character: "protagonist", text: "Расскажите, что на них изображено." },
        { character: "suspect", text: "Это... это не то, что кажется. Да, я передаю деньги Зотову, но это не взятка." },
        { character: "protagonist", text: "А что же это?" },
        { character: "suspect", text: "Это был долг. Я одолжил ему деньги несколько месяцев назад, и он возвращал. Мы просто встретились в неформальной обстановке." },
        { character: "protagonist", text: "И вы ожидаете, что я в это поверю?" },
        { character: "suspect", text: "Это правда! Виктор неправильно всё понял. Он увидел эти фотографии и решил, что может использовать их против меня." },
        { character: "protagonist", text: "Если это правда, почему вы так испугались шантажа?" },
        { character: "suspect", text: "Потому что даже если это не взятка, всё выглядит именно так! Мне никто не поверит, особенно учитывая, что Зотов возглавляет комитет по госконтрактам." },
        { character: "protagonist", text: "И поэтому вы убили Новикова?" },
        { character: "suspect", text: "Нет! Я не убивал его! Да, я был зол, мы поругались, но я не убивал его!" },
        { character: "protagonist", text: "Тогда объясните, почему вы солгали о своей травме руки?" },
        { character: "suspect", text: "Я... я испугался. Знал, что это выглядит подозрительно. Но клянусь, когда я уходил, Виктор был жив." },
      ],
      choices: {
        question: "Как вы оцениваете показания Кравцова?",
        options: [
          { text: "Он лжет и пытается выкрутиться", nextScene: 38 },
          { text: "В его словах может быть доля правды", nextScene: 39 },
          { text: "Нужно проверить его версию о долге Зотова", nextScene: 40 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Реакция Кравцова на фотографии",
        content: "Кравцов утверждает, что на фотографиях он не дает взятку Зотову, а возвращает долг. Признает, что испугался шантажа, так как ситуация выглядит компрометирующей. Продолжает отрицать убийство."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+Кравцова",
      dialogs: [
        { character: "protagonist", text: "Игорь, мы изучили финансовые отчеты вашей компании." },
        { character: null, text: "Вы показываете Кравцову документы с флешки Новикова." },
        { character: "protagonist", text: "Согласно этим данным, ваша компания на грани банкротства и полностью зависит от контракта с 'НовТех'." },
        { character: "suspect", text: "Откуда у вас... Черт, Виктор действительно копал под меня." },
        { character: "protagonist", text: "Это правда? Ваша компания в таком тяжелом положении?" },
        { character: "suspect", text: "Да, у нас финансовые трудности. Но это временно. У нас есть перспективные проекты." },
        { character: "protagonist", text: "Но без контракта с 'НовТех' вы бы обанкротились в течение месяца. Это очень сильный мотив для убийства." },
        { character: "suspect", text: "Послушайте, я бизнесмен. Если бы Виктор разорвал контракт, я бы нашел другие варианты. Может быть, взял кредит или привлек инвесторов." },
        { character: "protagonist", text: "С вашей кредитной историей? Сомневаюсь." },
        { character: "suspect", text: "Да, ситуация сложная, но не безвыходная. Убийство Виктора ничего бы не решило - контракт всё равно был бы расторгнут его преемником." },
        { character: "protagonist", text: "Если не вы, то кто мог убить Новикова?" },
        { character: "suspect", text: "Я не знаю... Может быть, Елена? Она ненавидела его после развода. Или Васнецов - они конкурировали за крупный контракт." },
        { character: "protagonist", text: "У Васнецова есть алиби. А вот у вас - нет." },
        { character: "suspect", text: "Я клянусь, я не убивал его! Да, мы поругались, но когда я уходил, он был жив!" },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Спросить о женщине, которую он видел в холле", nextScene: 41 },
          { text: "Уточнить детали его ссоры с Новиковым", nextScene: 42 },
          { text: "Предъявить обвинение в убийстве", nextScene: 43 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Конфронтация с финансовыми отчетами",
        content: "Кравцов признал тяжелое финансовое положение своей компании, но отрицает, что это достаточный мотив для убийства. Утверждает, что убийство Новикова не решило бы его проблем, так как контракт всё равно был бы расторгнут."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+Кравцова",
      dialogs: [
        { character: "protagonist", text: "Игорь, что означают эти цифры?" },
        { character: null, text: "Вы показываете Кравцову записку с цифрами 7-3-9-2-5, найденную в кармане Новикова." },
        { character: "suspect", text: "Не знаю. Первый раз вижу." },
        { character: "protagonist", text: "Это код от сейфа Новикова. В нем мы нашли фотографии, которыми он вас шантажировал." },
        { character: "suspect", text: "И что? Я не знал этого кода." },
        { character: "protagonist", text: "Интересно, что эти цифры совпадают с датой основания вашей компании - 7 марта 1992 года, 5-й месяц работы." },
        { character: "suspect", text: "Это... это совпадение." },
        { character: "protagonist", text: "Или Новиков использовал дату, которую вы бы легко запомнили. Возможно, он дал вам этот код?" },
        { character: "suspect", text: "Нет, он не давал мне никаких кодов." },
        { character: "protagonist", text: "Тогда откуда записка в его кармане? Зачем ему записывать код от собственного сейфа?" },
        { character: "suspect", text: "Не знаю! Может, он записал для кого-то другого?" },
        { character: "protagonist", text: "Для кого? Кому еще он мог доверить доступ к компромату на вас?" },
        { character: "suspect", text: "Понятия не имею. Может, своей девушке? Или адвокату?" },
        { character: "protagonist", text: "Или он дал код вам, чтобы вы могли проверить, что компромат реальный." },
        { character: "suspect", text: "Нет! Клянусь, он не давал мне никакого кода!" },
      ],
      choices: {
        question: "Как вы оцениваете реакцию Кравцова?",
        options: [
          { text: "Он явно что-то скрывает", nextScene: 44 },
          { text: "Возможно, он говорит правду", nextScene: 45 },
          { text: "Нужно проверить, кому еще Новиков мог дать код", nextScene: 46 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Код от сейфа",
        content: "Цифры из записки (7-3-9-2-5) совпадают с датой основания компании Кравцова. Он отрицает, что Новиков давал ему этот код, но выглядит неубедительно. Возможно, Новиков показывал ему компромат, хранящийся в сейфе."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Квартира+Елены+Орловой",
      dialogs: [
        { character: "protagonist", text: "Елена, я вижу, что вы нервничаете. Камеры зафиксировали женщину, похожую на вас, входящую в здание 'НовТех' вчера в 20:30." },
        { character: null, text: "Елена: 'Я... Хорошо, да, это была я. Но я не убивала Виктора!'" },
        { character: "protagonist", text: "Зачем вы солгали о том, что не были там?" },
        { character: null, text: "Елена: 'Я испугалась. Знала, что это выглядит подозрительно.'" },
        { character: "protagonist", text: "Расскажите, что произошло." },
        { character: null, text: "Елена: 'Я пришла поговорить с Виктором о дополнительной компенсации. Мой бизнес на грани банкротства, мне нужны были деньги.'" },
        { character: "protagonist", text: "И как прошел разговор?" },
        { character: null, text: "Елена: 'Ужасно. Когда я пришла, Виктор был уже мертв. Я нашла его на полу в крови...'" },
        { character: "protagonist", text: "И вы не вызвали полицию?" },
        { character: null, text: "Елена: 'Я запаниковала! Подумала, что меня обвинят в убийстве. У нас был конфликт, я угрожала ему... Я просто убежала.'" },
        { character: "protagonist", text: "Вы видели кого-нибудь, когда входили или выходили из здания?" },
        { character: null, text: "Елена: 'Когда я входила, я видела мужчину, выходящего из лифта. Кажется, это был Игорь Кравцов, партнер Виктора. Он выглядел взволнованным.'" },
        { character: "protagonist", text: "Что-нибудь еще необычное вы заметили в кабинете Виктора?" },
        { character: null, text: "Елена: 'Да... На столе были два бокала с виски. И еще... я видела запонку на полу. Золотую, с гравировкой.'" },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Спросить о запонке подробнее", nextScene: 47 },
          { text: "Уточнить, трогала ли она что-нибудь в кабинете", nextScene: 48 },
          { text: "Арестовать Елену за сокрытие информации", nextScene: 49 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Признание Елены Орловой",
        content: "Елена призналась, что была в офисе Новикова в 20:30, но утверждает, что нашла его уже мертвым. Не вызвала полицию из страха быть обвиненной. Видела Кравцова, выходящего из здания. Заметила два бокала на столе и золотую запонку на полу."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Лаборатория",
      dialogs: [
        { character: null, text: "Вы отправляете запонку, найденную на месте преступления, на экспертизу." },
        { character: "forensic", text: "Интересная находка, детектив. Это дорогая запонка ручной работы." },
        { character: "protagonist", text: "На ней есть отпечатки или ДНК?" },
        { character: "forensic", text: "Да, мы нашли частичный отпечаток пальца и следы ДНК. Сейчас проверяем по базе." },
        { character: null, text: "Через некоторое время эксперт возвращается с результатами." },
        { character: "forensic", text: "У нас есть совпадение по ДНК. Это Сергей Васнецов." },
        { character: "protagonist", text: "Васнецов? Но у него есть алиби на время убийства." },
        { character: "forensic", text: "Возможно. Но его ДНК на запонке, найденной на месте преступления, - это факт." },
        { character: "protagonist", text: "Есть ли на запонке какие-нибудь особые метки?" },
        { character: "forensic", text: "Да, внутри гравировка - 'С.В. от Е.О.'. Похоже на инициалы." },
        { character: "protagonist", text: "С.В. - Сергей Васнецов. А Е.О. - возможно, Елена Орлова, бывшая жена Новикова." },
        { character: "forensic", text: "Интересно. Также на запонке есть следы крови Новикова." },
        { character: "protagonist", text: "Значит, запонка была потеряна во время убийства или сразу после него." },
        { character: "forensic", text: "Похоже на то. И еще одна деталь - запонка была сломана, словно ее с силой оторвали." },
      ],
      choices: {
        question: "Что вы хотите сделать с этой информацией?",
        options: [
          { text: "Допросить Васнецова о запонке", nextScene: 50 },
          { text: "Спросить Елену Орлову о ее отношениях с Васнецовым", nextScene: 51 },
          { text: "Проверить алиби Васнецова еще раз", nextScene: 52 }
        ]
      },
      addEvidence: ["Результаты экспертизы запонки"],
      addNotebookEntry: {
        title: "Экспертиза запонки",
        content: "На запонке найдены ДНК Сергея Васнецова и следы крови Новикова. Внутри гравировка 'С.В. от Е.О.' - вероятно, подарок от Елены Орловой. Запонка была сломана, словно ее оторвали с силой. Это противоречит алиби Васнецова."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Ресторан+Метрополь",
      dialogs: [
        { character: null, text: "Вы приезжаете в ресторан 'Метрополь', чтобы опросить персонал о вечере убийства." },
        { character: "protagonist", text: "Здравствуйте. Я детектив из отдела особо важных дел. Мне нужна информация о посетителях, которые были здесь вчера вечером." },
        { character: null, text: "Метрдотель: 'Конечно, чем могу помочь?'" },
        { character: "protagonist", text: "Этот человек ужинал здесь вчера около 18:00-19:00." },
        { character: null, text: "Вы показываете фотографию Виктора Новикова." },
        { character: null, text: "Метрдотель: 'Да, господин Новиков. Он постоянный клиент. Вчера он ужинал с молодой женщиной.'" },
        { character: "protagonist", text: "Вы можете описать эту женщину?" },
        { character: null, text: "Метрдотель: 'Брюнетка, около 30 лет, очень элегантная. Кажется, она работает в его компании.'" },
        { character: "protagonist", text: "Марина Соловьева?" },
        { character: null, text: "Метрдотель: 'Да, точно! Они часто ужинают вместе.'" },
        { character: "protagonist", text: "Как они выглядели? О чем говорили?" },
        { character: null, text: "Метрдотель: 'Они выглядели... напряженными. Обычно они очень близки, но вчера между ними чувствовалась какая-то холодность.'" },
        { character: "protagonist", text: "Вы слышали что-нибудь из их разговора?" },
        { character: null, text: "Метрдотель: 'Нет, но официант, который их обслуживал, мог что-то слышать. Сейчас я его позову.'" },
        { character: null, text: "Официант рассказывает, что слышал, как Новиков и Соловьева спорили о каком-то решении, которое принял Новиков." },
        { character: null, text: "Официант: 'Женщина говорила что-то вроде: 'Ты не должен делать это один. Это слишком опасно.' А мужчина ответил: 'Я должен положить этому конец сегодня.''" },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Допросить Марину Соловьеву еще раз", nextScene: 53 },
          { text: "Проверить, был ли кто-то еще из подозреваемых в ресторане", nextScene: 54 },
          { text: "Вернуться к расследованию в офисе Новикова", nextScene: 13 }
        ]
      },
      addEvidence: ["Показания персонала ресторана 'Метрополь'"],
      addNotebookEntry: {
        title: "Ресторан 'Метрополь'",
        content: "Новиков ужинал с Мариной Соловьевой перед смертью. Они выглядели напряженными, что необычно. Марина говорила Новикову, что 'это слишком опасно', а он ответил, что 'должен положить этому конец сегодня'. Вероятно, речь шла о встрече с Кравцовым."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Юридический+отдел",
      dialogs: [
        { character: "protagonist", text: "Марина, что вы знаете об отношениях Елены Орловой и Виктора Новикова после развода?" },
        { character: null, text: "Марина: 'Они были... напряженными. Елена считала, что Виктор обманул ее при разделе имущества.'" },
        { character: "protagonist", text: "А вы лично знакомы с Еленой?" },
        { character: null, text: "Марина: 'Мы встречались несколько раз на корпоративных мероприятиях, когда они еще были женаты. После развода я ее не видела.'" },
        { character: "protagonist", text: "Виктор рассказывал вам о своих конфликтах с бывшей женой?" },
        { character: null, text: "Марина: 'Да, он говорил, что она угрожала ему. Требовала больше денег, угрожала раскрыть какие-то его секреты.'" },
        { character: "protagonist", text: "Какие секреты?" },
        { character: null, text: "Марина: 'Он не вдавался в подробности. Сказал только, что в начале карьеры принимал некоторые... сомнительные решения.'" },
        { character: "protagonist", text: "Вы знаете что-нибудь о связи между Еленой Орловой и Сергеем Васнецовым?" },
        { character: null, text: "Марина выглядит удивленной." },
        { character: null, text: "Марина: 'Между ними есть связь? Я не знала. Хотя... Виктор однажды упомянул, что Елена и Сергей были близки в университете, до того, как она познакомилась с Виктором.'" },
        { character: "protagonist", text: "Они могли возобновить отношения после развода Елены и Виктора?" },
        { character: null, text: "Марина: 'Не знаю. Но это было бы... интересным совпадением, учитывая конкуренцию между Виктором и Сергеем.'" },
      ],
      choices: {
        question: "Что вы хотите спросить у Марины?",
        options: [
          { text: "О ее алиби на время убийства", nextScene: 30 },
          { text: "О разговоре в ресторане 'Метрополь'", nextScene: 53 },
          { text: "О ее отношениях с Новиковым", nextScene: 55 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Елена Орлова и Сергей Васнецов",
        content: "По словам Марины, Елена и Сергей были близки в университете, до знакомства с Новиковым. Елена угрожала раскрыть какие-то 'секреты' Новикова из начала его карьеры. Возможная связь между Еленой и Сергеем после развода может быть важным фактором в деле."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Юридический+отдел",
      dialogs: [
        { character: "protagonist", text: "Марина, знаете ли вы о других врагах Виктора Новикова?" },
        { character: null, text: "Марина: 'Кроме Кравцова и Васнецова? Ну, был еще Андрей Климов, его бывший заместитель.'" },
        { character: "protagonist", text: "Расскажите о нем подробнее." },
        { character: null, text: "Марина: 'Виктор уволил его около месяца назад. Обвинил в передаче информации конкурентам. Климов всё отрицал и угрожал раскрыть какие-то секреты компании.'" },
        { character: "protagonist", text: "Какие секреты?" },
        { character: null, text: "Марина: 'Не знаю точно. Но Виктор был очень обеспокоен. Он даже нанял частного детектива, чтобы следить за Климовым.'" },
        { character: "protagonist", text: "И что выяснил детектив?" },
        { character: null, text: "Марина: 'Что Климов встречался с Сергеем Васнецовым. Вскоре после этого Климов устроился в 'ТехноПрогресс'.'" },
        { character: "protagonist", text: "Как отреагировал Новиков?" },
        { character: null, text: "Марина: 'Он был в ярости. Сказал, что Васнецов перешел все границы. Это было примерно за неделю до... до убийства.'" },
        { character: "protagonist", text: "Новиков предпринял какие-то действия?" },
        { character: null, text: "Марина: 'Он собирался подать официальную жалобу в антимонопольную службу. У него были доказательства, что Васнецов получил доступ к коммерческому предложению 'НовТех' через Климова.'" },
        { character: "protagonist", text: "Эти доказательства были на флешке в сейфе?" },
        { character: null, text: "Марина: 'Возможно. Виктор не рассказывал мне все детали.'" },
      ],
      choices: {
        question: "Что вы хотите сделать дальше?",
        options: [
          { text: "Найти и допросить Андрея Климова", nextScene: 31 },
          { text: "Проверить связь между Климовым и Васнецовым", nextScene: 32 },
          { text: "Спросить Марину о ее алиби", nextScene: 30 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Андрей Климов и Сергей Васнецов",
        content: "Новиков нанял частного детектива, который выяснил, что Климов встречался с Васнецовым после увольнения. Вскоре Климов устроился в компанию Васнецова. Новиков собирался подать жалобу на промышленный шпионаж, у него были доказательства."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Офис+НовТех+-+Юридический+отдел",
      dialogs: [
        { character: "protagonist", text: "Марина, где вы были вчера вечером после ужина с Новиковым?" },
        { character: null, text: "Марина: 'Я поехала домой. Была там примерно с 19:30.'" },
        { character: "protagonist", text: "Кто-нибудь может подтвердить ваше алиби?" },
        { character: null, text: "Марина: 'Я живу одна. Но я разговаривала по телефону с подругой около 20:00, она может подтвердить.'" },
        { character: "protagonist", text: "Вы выглядели напряженными во время ужина. О чем вы спорили?" },
        { character: null, text: "Марина выглядит удивленной." },
        { character: null, text: "Марина: 'Вы разговаривали с персоналом ресторана? Да, мы... у нас был непростой разговор.'" },
        { character: "protagonist", text: "О чем именно?" },
        { character: null, text: "Марина: 'Виктор рассказал мне о своих планах confronted Кравцова с доказательствами коррупции. Я считала, что это опасно.'" },
        { character: "protagonist", text: "Почему?" },
        { character: null, text: "Марина: 'Потому что Кравцов - не тот человек, с которым можно шутить. У него связи в криминальном мире. Я боялась за Виктора.'" },
        { character: "protagonist", text: "Вы пытались отговорить его?" },
        { character: null, text: "Марина: 'Да, но он был непреклонен. Сказал, что должен 'положить этому конец сегодня'.'" },
        { character: "protagonist", text: "И вы просто позволили ему пойти на эту встречу одному?" },
        { character: null, text: "Марина: 'Я предлагала пойти с ним, но он отказался. Сказал, что это его дело и он разберется сам.'" },
      ],
      choices: {
        question: "Как вы оцениваете показания Марины?",
        options: [
          { text: "Она говорит правду", nextScene: 56 },
          { text: "Она что-то скрывает", nextScene: 57 },
          { text: "Нужно проверить ее алиби", nextScene: 58 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Алиби Марины Соловьевой",
        content: "Утверждает, что была дома с 19:30, разговаривала по телефону с подругой около 20:00. Признает, что пыталась отговорить Новикова от встречи с Кравцовым, считая это опасным. Предлагала пойти с ним, но он отказался."
      }
    },
    {
      background: "/images/novel/locations/novtech.png?height=720&width=1280&text=Офис+ТехноПрогресс",
      dialogs: [  
        { character: "protagonist", text: "Сергей, расскажите о ваших отношениях с Андреем Климовым." },
        { character: null, text: "Васнецов: 'Андрей? Он работает у меня последние несколько недель. Талантливый специалист.'" },
        { character: "protagonist", text: "Вы знали, что он был уволен из 'НовТех' за передачу конфиденциальной информации?" },
        { character: null, text: "Васнецов: 'Да, он рассказал мне об этом. Но отрицал обвинения. Сказал, что Новиков просто искал козла отпущения.'" },
        { character: "protagonist", text: "И вы поверили ему?" },
        { character: null, text: "Васнецов: 'Я знаю Виктора много лет. Он всегда был параноиком. Я решил дать Андрею шанс.'" },
        { character: "protagonist", text: "Очень великодушно с вашей стороны. Особенно учитывая, что вскоре после этого вы получили доступ к коммерческому предложению 'НовТех'." },
        { character: null, text: "Васнецов напрягается." },
        { character: null, text: "Васнецов: 'Я не знаю, о чем вы говорите.'" },
        { character: "protagonist", text: "У Новикова были доказательства промышленного шпионажа с вашей стороны. Он собирался подать жалобу в антимонопольную службу." },
        { character: null, text: "Васнецов: 'Это абсурд. У меня не было доступа к их предложению.'" },
        { character: "protagonist", text: "Тогда как объяснить, что ваше предложение было почти идентичным, но с чуть более выгодными условиями?" },
        { character: null, text: "Васнецов: 'Совпадение. Или, может быть, у нас обоих был доступ к одной и той же рыночной информации.'" },
        { character: "protagonist", text: "Новиков угрожал разрушить вашу репутацию и лишить вас контракта на 500 миллионов. Очень сильный мотив для убийства." },
        { character: null, text: "Васнецов: 'Но у меня есть алиби! Я был на деловом ужине с инвесторами!'" },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Спросить о его отношениях с Еленой Орловой", nextScene: 59 },
          { text: "Показать запонку, найденную на месте преступления", nextScene: 50 },
          { text: "Уточнить детали его алиби", nextScene: 52 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Васнецов и Климов",
        content: "Васнецов нанял Климова сразу после его увольнения из 'НовТех'. Отрицает, что получал от него конфиденциальную информацию, но нервничает при упоминании об этом. Настаивает на своем алиби - деловой ужин с инвесторами."
      }
    },
    {
      background: "/images/novel/locations/novtech.png?height=720&width=1280&text=Офис+ТехноПрогресс",
      dialogs: [
        { character: "protagonist", text: "Сергей, вы знакомы с Игорем Кравцовым?" },
        { character: null, text: "Васнецов: 'Конечно. Мы в одной отрасли, пересекались на различных мероприятиях.'" },
        { character: "protagonist", text: "Насколько близко вы общаетесь?" },
        { character: null, text: "Васнецов: 'Не очень. Мы скорее конкуренты, чем друзья.'" },
        { character: "protagonist", text: "Странно, потому что у нас есть информация, что вы встречались с ним несколько раз за последний месяц." },
        { character: null, text: "Васнецов выглядит удивленным." },
        { character: null, text: "Васнецов: 'Кто вам такое сказал? Это неправда.'" },
        { character: "protagonist", text: "У нас есть фотографии. Вы встречались с Кравцовым в кафе 'Централь' три раза за последние две недели." },
        { character: null, text: "Васнецов: 'Я... Хорошо, да, мы встречались. Но это были просто деловые встречи.'" },
        { character: "protagonist", text: "О чем вы говорили?" },
        { character: null, text: "Васнецов: 'О возможном сотрудничестве. Мы обсуждали объединение усилий против 'НовТех'.'" },
        { character: "protagonist", text: "То есть, вы сговаривались против Новикова?" },
        { character: null, text: "Васнецов: 'Не сговаривались! Просто обсуждали возможности. В бизнесе это нормально.'" },
        { character: "protagonist", text: "И что решили?" },
        { character: null, text: "Васнецов: 'Ничего конкретного. Кравцов был слишком зависим от контракта с 'НовТех', чтобы идти против Новикова.'" },
      ],
      choices: {
        question: "Как вы оцениваете показания Васнецова?",
        options: [
          { text: "Он лжет о характере встреч с Кравцовым", nextScene: 60 },
          { text: "Возможно, он говорит правду", nextScene: 61 },
          { text: "Нужно проверить информацию у Кравцова", nextScene: 62 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Васнецов и Кравцов",
        content: "Васнецов сначала отрицал, потом признал встречи с Кравцовым. Утверждает, что они обсуждали возможное сотрудничество против 'НовТех', но не пришли к конкретным решениям. Возможный сговор против Новикова."
      }
    },
    {
      background: "/images/novel/locations/novtech.png?height=720&width=1280&text=Офис+ТехноПрогресс",
      dialogs: [
        { character: "protagonist", text: "Сергей, вы уже знаете результаты тендера на госконтракт?" },
        { character: null, text: "Васнецов: 'Да, объявили сегодня утром. Мы выиграли.'" },
        { character: "protagonist", text: "Поздравляю. 500 миллионов рублей - впечатляющая сумма." },
        { character: null, text: "Васнецов: 'Спасибо. Мы долго к этому шли.'" },
        { character: "protagonist", text: "И очень удачно, что Новиков не успел подать жалобу в антимонопольную службу, не так ли?" },
        { character: null, text: "Васнецов: 'Я не понимаю, на что вы намекаете.'" },
        { character: "protagonist", text: "Новиков собирался обвинить вас в промышленном шпионаже. Это могло не только лишить вас контракта, но и привести к уголовному делу." },
        { character: null, text: "Васнецов: 'Это были пустые угрозы. У него не было доказательств.'" },
        { character: "protagonist", text: "Были. На флешке в его сейфе. И теперь они у нас." },
        { character: null, text: "Васнецов заметно бледнеет." },
        { character: null, text: "Васнецов: 'Я... Я не знаю, о чем вы говорите.'" },
        { character: "protagonist", text: "Знаете, Сергей. И вы понимали, что если Новиков подаст эту жалобу, вы потеряете всё. Репутацию, контракты, возможно, свободу." },
        { character: null, text: "Васнецов: 'Послушайте, у меня есть алиби. Я был на деловом ужине весь вечер.'" },
        { character: "protagonist", text: "Да, с 19:00 до 22:00. Но убийство произошло между 20:15 и 20:50. Вы могли ненадолго отлучиться, никто бы не заметил." },
        { character: null, text: "Васнецов: 'Это абсурд! Зачем мне убивать Виктора?'" },
        { character: "protagonist", text: "Чтобы спасти свою компанию и репутацию. 500 миллионов рублей - очень веский мотив." },
        { character: null, text: "Васнецов: 'У вас нет доказательств моей причастности к убийству.'" },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Показать запонку, найденную на месте преступления", nextScene: 50 },
          { text: "Спросить о его отношениях с Еленой Орловой", nextScene: 59 },
          { text: "Проверить его телефонные звонки в вечер убийства", nextScene: 63 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Мотив Васнецова",
        content: "Васнецов выиграл тендер на 500 миллионов рублей. Новиков собирался подать жалобу, которая могла лишить его этого контракта и привести к уголовному делу. Очень сильный мотив для убийства. Алиби Васнецова не исключает возможности его отлучки с делового ужина."
      }
    },
    {
      background: "/images/novel/locations/novtech.png?height=720&width=1280&text=Офис+ТехноПрогресс",
      dialogs: [
        { character: "protagonist", text: "Сергей, что это?" },
        { character: null, text: "Вы показываете Васнецову запонку, найденную на месте преступления." },
        { character: null, text: "Васнецов заметно бледнеет." },
        { character: null, text: "Васнецов: 'Я... не знаю.'" },
        { character: "protagonist", text: "Не лгите. Это ваша запонка. На ней ваша ДНК и следы крови Новикова." },
        { character: null, text: "Васнецов: 'Это невозможно! Я не был в офисе Виктора вчера!'" },
        { character: "protagonist", text: "Тогда объясните, как ваша запонка оказалась на месте убийства?" },
        { character: null, text: "Васнецов: 'Я... я не знаю. Может быть, кто-то подбросил ее?'" },
        { character: "protagonist", text: "Интересная гравировка - 'С.В. от Е.О.'. Сергей Васнецов от Елены Орловой?" },
        { character: null, text: "Васнецов молчит несколько секунд." },
        { character: null, text: "Васнецов: 'Хорошо. Да, это мои запонки. Подарок от Елены.'" },
        { character: "protagonist", text: "Вы и Елена близки?" },
        { character: null, text: "Васнецов: 'Мы... да, у нас отношения. Уже несколько месяцев.'" },
        { character: "protagonist", text: "С момента ее развода с Новиковым?" },
        { character: null, text: "Васнецов: 'Примерно. Мы были близки еще в университете, до того, как она познакомилась с Виктором.'" },
        { character: "protagonist", text: "И вы решили возобновить отношения после ее развода. Как романтично. И как удобно для бизнеса." },
        { character: null, text: "Васнецов: 'Это не имеет отношения к бизнесу! Мы любим друг друга.'" },
        { character: "protagonist", text: "Тогда объясните, как ваша запонка оказалась на месте убийства?" },
      ],
      choices: {
        question: "Как вы оцениваете реакцию Васнецова?",
        options: [
          { text: "Он лжет и причастен к убийству", nextScene: 64 },
          { text: "Он говорит правду об отношениях с Еленой, но что-то скрывает", nextScene: 65 },
          { text: "Нужно допросить Елену о ее отношениях с Васнецовым", nextScene: 51 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Запонка и отношения Васнецова с Еленой",
        content: "Васнецов признал, что запонка принадлежит ему - подарок от Елены Орловой. Также признал романтические отношения с ней, начавшиеся после ее развода с Новиковым. Не может объяснить, как его запонка оказалась на месте преступления."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Квартира+Елены+Орловой",
      dialogs: [
        { character: "protagonist", text: "Елена, расскажите о ваших отношениях с Сергеем Васнецовым." },
        { character: null, text: "Елена выглядит удивленной." },
        { character: null, text: "Елена: 'Что? Почему вы спрашиваете?'" },
        { character: "protagonist", text: "Просто ответьте на вопрос." },
        { character: null, text: "Елена: 'Мы... знакомы. Учились вместе в университете.'" },
        { character: "protagonist", text: "И это всё?" },
        { character: null, text: "Елена: 'Что вы хотите услышать?'" },
        { character: "protagonist", text: "Правду, Елена. Мы знаем, что у вас роман с Васнецовым." },
        { character: null, text: "Елена вздыхает." },
        { character: null, text: "Елена: 'Хорошо. Да, мы встречаемся. Уже несколько месяцев.'" },
        { character: "protagonist", text: "С момента вашего развода с Новиковым?" },
        { character: null, text: "Елена: 'Примерно. Мы были близки еще в университете, до того, как я познакомилась с Виктором.'" },
        { character: "protagonist", text: "Почему вы скрывали эти отношения?" },
        { character: null, text: "Елена: 'Потому что знала, как это будет выглядеть! Бывшая жена Новикова встречается с его главным конкурентом.'" },
        { character: "protagonist", text: "Виктор знал о ваших отношениях с Васнецовым?" },
        { character: null, text: "Елена: 'Нет... То есть, я не говорила ему. Но Виктор всегда всё узнавал.'" },
        { character: "protagonist", text: "Что это?" },
        { character: null, text: "Вы показываете Елене запонку, найденную на месте преступления." },
        { character: null, text: "Елена: 'Это... запонка Сергея. Я подарила ему этот набор на день рождения.'" },
      ],
      choices: {
        question: "Как вы хотите продолжить допрос?",
        options: [
          { text: "Спросить, как запонка Васнецова оказалась на месте преступления", nextScene: 66 },
          { text: "Уточнить, знала ли она о планах Новикова подать жалобу на Васнецова", nextScene: 67 },
          { text: "Спросить, не планировали ли они с Васнецовым избавиться от Новикова", nextScene: 68 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Елена и Васнецов",
        content: "Елена признала романтические отношения с Васнецовым, начавшиеся после ее развода с Новиковым. Они были близки еще в университете. Подтвердила, что запонка принадлежит Васнецову - ее подарок ему на день рождения. Скрывала отношения, понимая, как это будет выглядеть."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Полицейский+участок+-+Комната+для+допросов",
      dialogs: [
        { character: null, text: "После сбора всех улик и показаний вы возвращаетесь в участок для анализа дела." },
        { character: "captain", text: "Итак, детектив, что у вас есть?" },
        { character: "protagonist", text: "Сложное дело, капитан. У нас несколько подозреваемых, у каждого есть мотив." },
        { character: "captain", text: "Давайте по порядку." },
        { character: "protagonist", text: "Первый подозреваемый - Игорь Кравцов, деловой партнер Новикова. Мотив - Новиков шантажировал его компрометирующими фотографиями и собирался разорвать контракт, без которого компания Кравцова обанкротилась бы." },
        { character: "protagonist", text: "Кравцов был в офисе Новикова в вечер убийства, они поругались. На его руке следы борьбы. Но он утверждает, что когда уходил в 20:15, Новиков был жив." },
        { character: "captain", text: "Второй подозреваемый?" },
        { character: "protagonist", text: "Сергей Васнецов, конкурент Новикова. Мотив - Новиков собирался подать жалобу о промышленном шпионаже, что могло лишить Васнецова контракта на 500 миллионов и привести к уголовному делу." },
        { character: "protagonist", text: "У Васнецова есть алиби - деловой ужин с инвесторами. Но на месте преступления найдена его запонка со следами крови Новикова." },
        { character: "captain", text: "Интересно. Кто еще?" },
        { character: "protagonist", text: "Елена Орлова, бывшая жена Новикова. Мотив - обида после развода, финансовые проблемы. Она тайно встречается с Васнецовым." },
        { character: "protagonist", text: "Елена приходила в офис Новикова в 20:30, но утверждает, что нашла его уже мертвым и в панике убежала." },
        { character: "captain", text: "Еще кто-нибудь?" },
        { character: "protagonist", text: "Андрей Климов, бывший заместитель Новикова, уволенный за предполагаемую передачу информации конкурентам. Сейчас работает на Васнецова." },
        { character: "captain", text: "Итак, кто убил Новикова?" },
      ],
      choices: {
        question: "Кого вы считаете убийцей?",
        options: [
          { text: "Игорь Кравцов", nextScene: 69 },
          { text: "Сергей Васнецов", nextScene: 70 },
          { text: "Елена Орлова", nextScene: 71 },
          { text: "Сговор Васнецова и Елены", nextScene: 72 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Анализ дела",
        content: "Подозреваемые: 1) Кравцов - шантаж, финансовые проблемы, был на месте преступления; 2) Васнецов - угроза жалобы о промышленном шпионаже, его запонка на месте преступления; 3) Елена - обида после развода, отношения с Васнецовым, была в офисе; 4) Климов - уволен Новиковым, работает на Васнецова."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Полицейский+участок+-+Зал+для+брифингов",
      dialogs: [
        { character: null, text: "Вы собираете всех подозреваемых в зале для брифингов. Напряжение ощутимо." },
        { character: "protagonist", text: "Благодарю всех за то, что пришли. Как вы знаете, мы расследуем убийство Виктора Новикова." },
        { character: "protagonist", text: "После тщательного расследования мы пришли к выводу, что убийство было совершено в результате сговора." },
        { character: "protagonist", text: "Сергей Васнецов и Елена Орлова, вы арестованы по подозрению в убийстве Виктора Новикова." },
        { character: null, text: "Васнецов: 'Это абсурд! У меня есть алиби!'" },
        { character: null, text: "Елена: 'Я не убивала Виктора! Я нашла его уже мертвым!'" },
        { character: "protagonist", text: "Позвольте объяснить, как всё произошло." },
        { character: "protagonist", text: "Сергей, вы были в отчаянном положении. Новиков собирался подать жалобу о промышленном шпионаже, что разрушило бы вашу компанию и репутацию." },
        { character: "protagonist", text: "Елена, вы ненавидели бывшего мужа за то, как он поступил с вами при разводе. К тому же, ваш бизнес был на грани банкротства." },
        { character: "protagonist", text: "Вы оба решили избавиться от Новикова. План был прост: у Васнецова было алиби - деловой ужин с инвесторами. Елена должна была выполнить грязную работу." },
        { character: "protagonist", text: "Но что-то пошло не так. Во время борьбы Васнецов потерял запонку - подарок Елены. Улика, которая напрямую связывает его с местом преступления." },
        { character: null, text: "Васнецов: 'Это смешно! Я не был в офисе Виктора!'" },
        { character: "protagonist", text: "Тогда объясните, как ваша запонка оказалась там? На ней ваша ДНК и кровь Новикова." },
        { character: null, text: "Васнецов молчит." },
        { character: "protagonist", text: "Елена, вы пришли в офис в 20:30, но не для того, чтобы поговорить с Новиковым. Вы пришли, чтобы убедиться, что всё сделано правильно, и забрать улики." },
        { character: null, text: "Елена: 'Нет! Я говорила правду! Я нашла его уже мертвым!'" },
        { character: "protagonist", text: "Тогда почему вы не вызвали полицию? Почему убежали?" },
        { character: null, text: "Елена: 'Я запаниковала! Я боялась, что меня обвинят!'" },
        { character: "protagonist", text: "Или вы боялись, что мы найдем доказательства вашей причастности?" },
      ],
      choices: {
        question: "Как завершить дело?",
        options: [
          { text: "Арестовать Васнецова и Елену", nextScene: 73 },
          { text: "Дать им шанс признаться", nextScene: 74 },
          { text: "Представить дополнительные доказательства", nextScene: 75 }
        ]
      },
      addEvidence: null,
      addNotebookEntry: {
        title: "Разоблачение",
        content: "Предъявлены обвинения Сергею Васнецову и Елене Орловой в сговоре с целью убийства Новикова. Мотивы: для Васнецова - угроза жалобы о промышленном шпионаже, для Елены - обида после развода и финансовые проблемы. Ключевая улика - запонка Васнецова на месте преступления."
      }
    },
    {
      background: "/images/novel/locations/office_universal.png?height=720&width=1280&text=Полицейский+участок+-+Кабинет+капитана",
      dialogs: [
        { character: null, text: "После ареста Васнецова и Елены вы возвращаетесь в кабинет капитана для подведения итогов." },
        { character: "captain", text: "Отличная работа, детектив. Дело закрыто." },
        { character: "protagonist", text: "Спасибо, капитан. Это было непростое расследование." },
        { character: "captain", text: "Расскажите, как вы пришли к выводу, что это был сговор?" },
        { character: "protagonist", text: "Ключевой уликой стала запонка Васнецова, найденная на месте преступления. Несмотря на его алиби, это доказывало, что он был там." },
        { character: "protagonist", text: "Кроме того, тайные отношения между Васнецовым и Еленой, которые они скрывали, указывали на возможный сговор." },
        { character: "protagonist", text: "У обоих был сильный мотив: Васнецов мог потерять контракт на 500 миллионов и столкнуться с уголовным делом, Елена ненавидела бывшего мужа и нуждалась в деньгах." },
        { character: "captain", text: "А как насчет Кравцова? Он тоже был подозреваемым." },
        { character: "protagonist", text: "Кравцов действительно был в офисе Новикова в тот вечер, но его версия подтвердилась. Он ушел в 20:15, а смерть наступила позже." },
        { character: "captain", text: "Что будет дальше?" },
        { character: "protagonist", text: "Прокуратура готовит обвинение. У нас достаточно улик для суда." },
        { character: "captain", text: "Еще раз поздравляю. Мэр будет доволен быстрым раскрытием дела." },
        { character: "protagonist", text: "Спасибо, капитан. Я просто делал свою работу." },
        { character: null, text: "Вы выходите из кабинета капитана с чувством выполненного долга. Еще одно дело раскрыто, еще одно преступление не осталось безнаказанным." },
        { character: null, text: "КОНЕЦ" },
      ],
      choices: null,
      addEvidence: null,
      addNotebookEntry: {
        title: "Завершение дела",
        content: "Дело успешно раскрыто. Васнецов и Елена арестованы по обвинению в убийстве Новикова. Ключевые улики: запонка Васнецова на месте преступления, тайные отношения между подозреваемыми, сильные мотивы у обоих. Прокуратура готовит обвинение для суда."
      }
    }
  ]

  const nextDialog = () => {
    if (dialogIndex < scenes[currentScene]?.dialogs?.length - 1) {
      setDialogIndex(dialogIndex + 1)
    } else {
      if (scenes[currentScene]?.choices) {
        setShowChoices(true)
      } else if (scenes[currentScene]?.addNotebookEntry) {
        setNotebookEntries([...notebookEntries, scenes[currentScene]?.addNotebookEntry])
        if (currentScene < scenes.length - 1) {
          setCurrentScene(currentScene + 1)
          setDialogIndex(0)
          setShowChoices(false)
        } else {
          setGameState("end")
        }
      } else {
        if (currentScene < scenes.length - 1) {
          setCurrentScene(currentScene + 1)
          setDialogIndex(0)
          setShowChoices(false)
        } else {
          setGameState("end")
        }
      }
    }
  }

  const makeChoice = (nextScene: number) => {
    if (scenes[currentScene]?.addNotebookEntry) {
      setNotebookEntries([...notebookEntries, scenes[currentScene]?.addNotebookEntry])
    }
    if (scenes[currentScene]?.addEvidence) {
      setEvidenceItems([...evidenceItems, ...scenes[currentScene]?.addEvidence])
    }
    setCurrentScene(nextScene)
    setDialogIndex(0)
    setShowChoices(false)
  }

  const startGame = () => {
    setGameState("game")
  }

  const openTheory = () => {
    setGameState("theory")
    setShowTheoryModal(true)
  }

  const getCurrentDialog = () => {
    if (scenes[currentScene] && scenes[currentScene]?.dialogs && scenes[currentScene]?.dialogs[dialogIndex]) {
      return scenes[currentScene].dialogs[dialogIndex]
    }
    return null
  }

  const getCharacterName = (characterKey: string | null) => {
    if (!characterKey) return null
    return characterKey in characters ? characters[characterKey as CharacterKey].name : characterKey
  }

  const getCharacterImage = (characterKey: string | null) => {
    if (!characterKey) return null
    return characterKey in characters ? characters[characterKey as CharacterKey].image : null
  }

  useEffect(() => {
    if (
      scenes[currentScene] &&
      scenes[currentScene]?.addEvidence &&
      dialogIndex === scenes[currentScene]?.dialogs?.length - 1
    ) {
      setEvidenceItems(prevItems => [...prevItems, ...scenes[currentScene]?.addEvidence || []])
    }
  }, [currentScene, dialogIndex])

  return (
    <div className="min-h-screen bg-white text-black">
      {gameState === "intro" && (
        <div className="min-h-screen flex flex-col items-center justify-center p-8 bg-gradient-to-b from-blue-50 to-white">
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="text-center mb-8"
          >
            <h1 className="text-4xl md:text-5xl font-bold mb-4">Дело о смерти директора</h1>
            <p className="text-xl text-gray-700 max-w-2xl mx-auto">
              Интерактивная детективная новелла с элементами обучения
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.3, duration: 0.5 }}
            className="relative w-full max-w-4xl aspect-video rounded-xl overflow-hidden mb-8"
          >
            <Image
              src="/images/novel/visualprev.jpg?height=720&width=1280&text=Детективная+новелла"
              alt="Детективная новелла"
              fill
              className="object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end">
              <div className="p-8">
                <h2 className="text-2xl font-bold mb-2 text-gray-100">Расследуйте убийство, принимайте решения, раскройте правду</h2>
                <p className="text-gray-300">
                  Вы - детектив, которому поручено расследовать убийство влиятельного бизнесмена. Каждое ваше решение
                  влияет на ход расследования.
                </p>
              </div>
            </div>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.6, duration: 0.5 }}
            className="flex flex-col md:flex-row gap-4"
          >
            <Button size="lg" onClick={startGame} className="flex items-center gap-2">
              <Play className="h-5 w-5" />
              Начать расследование
            </Button>
            <Button size="lg" variant="outline" onClick={openTheory} className="flex items-center gap-2">
              <BookOpen className="h-5 w-5" />
              Теоретические материалы
            </Button>
          </motion.div>
        </div>
      )}

      {gameState === "game" && (
        <div className="relative min-h-screen flex flex-col">
          <div className="bg-blue-900 p-4 flex items-center justify-between text-white">
            <div className="flex items-center gap-4">
              <Button variant="ghost" size="icon" onClick={() => setShowMenu(!showMenu)}>
                <Menu className="h-5 w-5" />
              </Button>
              <h1 className="text-lg font-medium">Дело о смерти директора</h1>
            </div>

            <div className="flex items-center gap-2">
              <Button variant="ghost" size="icon" onClick={() => setShowNotebook(!showNotebook)}>
                <FileText className="h-5 w-5" />
              </Button>
              <Button variant="ghost" size="icon" onClick={() => setShowEvidence(!showEvidence)}>
                <Bookmark className="h-5 w-5" />
              </Button>
              <Button variant="ghost" size="icon" onClick={() => setIsMuted(!isMuted)}>
                {isMuted ? <VolumeX className="h-5 w-5" /> : <Volume2 className="h-5 w-5" />}
              </Button>
              <Button variant="ghost" size="icon" onClick={() => setShowTheoryModal(true)}>
                <BookOpen className="h-5 w-5" />
              </Button>
            </div>
          </div>

          <div className="relative flex-grow">
            <div className="absolute inset-0">
              <Image
                src={scenes[currentScene]?.background || "/images/novel/locations/office_universal.png"}
                alt="Background"
                fill
                className="object-cover"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent" />
            </div>

            <AnimatePresence mode="wait">
              {getCurrentDialog()?.character && (
                <div className="absolute bottom-[150px] left-1/2 -translate-x-1/2">
                  <motion.div
                    initial={{ opacity: 0, y: 50, scale: 0.9 }}
                    animate={{ opacity: 1, y: 0, scale: 1 }}
                    exit={{ opacity: 0, y: 20, scale: 0.95 }}
                    transition={{ 
                      type: "spring", 
                      damping: 15, 
                      stiffness: 100,
                      duration: 0.5 
                    }}
                    key={`character-${currentScene}-${dialogIndex}`}
                    className="relative h-[400px] w-[300px]"
                  >
                    <Image
                      src={getCharacterImage(getCurrentDialog()?.character || null) || "/images/novel/locations/office_universal.png"}
                      alt={getCharacterName(getCurrentDialog()?.character || null) || "Character"}
                      fill
                      className="object-contain"
                    />
                  </motion.div>
                </div>
              )}
            </AnimatePresence>

            <div className="absolute bottom-0 left-0 right-0 bg-white/95 p-4 border-t border-blue-200">
              {getCurrentDialog()?.character && (
                <div className="font-bold text-primary mb-2">{getCharacterName(getCurrentDialog()?.character || null)}</div>
              )}

              <AnimatePresence mode="wait">
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -10 }}
                  transition={{ 
                    type: "spring",
                    damping: 25,
                    stiffness: 300,
                    duration: 0.15
                  }}
                  key={`dialog-${currentScene}-${dialogIndex}`}
                  className="mb-4"
                >
                  <p className="text-lg">{getCurrentDialog()?.text}</p>
                </motion.div>
              </AnimatePresence>

              {showChoices ? (
                <div className="space-y-3">
                  <h3 className="font-medium text-gray-300 mb-2">{scenes[currentScene]?.choices?.question}</h3>
                  {scenes[currentScene]?.choices?.options.map((option, index) => (
                    <Button
                      key={index}
                      variant="outline"
                      className="w-full justify-start text-left h-auto py-3"
                      onClick={() => makeChoice(option.nextScene)}
                    >
                      {option.text}
                    </Button>
                  ))}
                </div>
              ) : (
                <div className="flex justify-end">
                  <Button onClick={nextDialog} className="flex items-center gap-2">
                    Далее
                    <ChevronRight className="h-4 w-4" />
                  </Button>
                </div>
              )}
            </div>

            <AnimatePresence>
              {showMenu && (
                <motion.div
                  initial={{ opacity: 0, x: -300 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: -300 }}
                  className="absolute top-0 left-0 bottom-0 w-64 bg-white border-r border-blue-200 z-10 text-black"
                >
                  <div className="p-4 border-b border-blue-200 flex items-center justify-between">
                    <h2 className="font-bold">Меню</h2>
                    <Button variant="ghost" size="icon" onClick={() => setShowMenu(false)}>
                      <X className="h-5 w-5" />
                    </Button>
                  </div>

                  <div className="p-4 space-y-4">
                    <Button variant="ghost" className="w-full justify-start" onClick={() => setGameState("intro")}>
                      <Home className="h-5 w-5 mr-2" />
                      Главное меню
                    </Button>
                    <Button variant="ghost" className="w-full justify-start" onClick={() => setShowTheoryModal(true)}>
                      <BookOpen className="h-5 w-5 mr-2" />
                      Теория
                    </Button>
                    <Button
                      variant="ghost"
                      className="w-full justify-start"
                      onClick={() => setShowNotebook(!showNotebook)}
                    >
                      <FileText className="h-5 w-5 mr-2" />
                      Блокнот
                    </Button>
                    <Button
                      variant="ghost"
                      className="w-full justify-start"
                      onClick={() => setShowEvidence(!showEvidence)}
                    >
                      <Bookmark className="h-5 w-5 mr-2" />
                      Улики
                    </Button>
                    <Button variant="ghost" className="w-full justify-start" onClick={() => setIsMuted(!isMuted)}>
                      {isMuted ? <VolumeX className="h-5 w-5 mr-2" /> : <Volume2 className="h-5 w-5 mr-2" />}
                      {isMuted ? "Включить звук" : "Выключить звук"}
                    </Button>
                    <Button variant="ghost" className="w-full justify-start">
                      <Save className="h-5 w-5 mr-2" />
                      Сохранить
                    </Button>
                    <Button variant="ghost" className="w-full justify-start">
                      <Settings className="h-5 w-5 mr-2" />
                      Настройки
                    </Button>
                    <Button variant="ghost" className="w-full justify-start">
                      <HelpCircle className="h-5 w-5 mr-2" />
                      Помощь
                    </Button>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>

            <AnimatePresence>
              {showNotebook && (
                <motion.div
                  initial={{ opacity: 0, x: 300 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: 300 }}
                  className="absolute top-0 right-0 bottom-0 w-80 bg-white border-l border-blue-200 z-10 overflow-y-auto text-black"
                >
                  <div className="p-4 border-b border-blue-200 flex items-center justify-between">
                    <h2 className="font-bold">Блокнот детектива</h2>
                    <Button variant="ghost" size="icon" onClick={() => setShowNotebook(false)}>
                      <X className="h-5 w-5" />
                    </Button>
                  </div>

                  <div className="p-4 space-y-4">
                    {notebookEntries.map((entry, index) => (
                      <div key={index} className="border border-blue-200 rounded-lg p-4">
                        <h3 className="font-medium text-primary mb-2">{entry.title}</h3>
                        <p className="text-sm text-gray-700">{entry.content}</p>
                      </div>
                    ))}
                  </div>
                </motion.div>
              )}
            </AnimatePresence>

            <AnimatePresence>
              {showEvidence && (
                <motion.div
                  initial={{ opacity: 0, y: 300 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: 300 }}
                  className="absolute bottom-[220px] left-0 right-0 bg-white border-t border-blue-200 z-10 max-h-[300px] overflow-y-auto text-black"
                >
                  <div className="p-4 border-b border-blue-200 flex items-center justify-between">
                    <h2 className="font-bold">Собранные улики</h2>
                    <Button variant="ghost" size="icon" onClick={() => setShowEvidence(false)}>
                      <X className="h-5 w-5" />
                    </Button>
                  </div>

                  <div className="p-4">
                    {evidenceItems.length > 0 ? (
                      <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                        {evidenceItems.map((item, index) => (
                          <div key={index} className="border border-blue-200 rounded-lg p-3 flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
                              <Bookmark className="h-5 w-5 text-primary" />
                            </div>
                            <div className="text-sm">{item}</div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center py-8 text-gray-400">
                        <Bookmark className="h-10 w-10 mx-auto mb-2 opacity-50" />
                        <p>Пока не найдено ни одной улики</p>
                      </div>
                    )}
                  </div>
                </motion.div>
              )}
            </AnimatePresence>

            <AnimatePresence>
              {showCharacterInfo && (
                <motion.div
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  exit={{ opacity: 0, scale: 0.9 }}
                  className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white border border-blue-200 rounded-lg p-6 max-w-md w-full z-20 text-black"
                >
                  <div className="flex items-start justify-between mb-4">
                    <h2 className="font-bold text-xl">{showCharacterInfo && characters[showCharacterInfo].name}</h2>
                    <Button variant="ghost" size="icon" onClick={() => setShowCharacterInfo(null)}>
                      <X className="h-5 w-5" />
                    </Button>
                  </div>

                  <div className="flex gap-4 mb-4">
                    <div className="relative w-24 h-32 rounded-lg overflow-hidden">
                      <Image
                        src={showCharacterInfo ? characters[showCharacterInfo].image : "/placeholder.svg"}
                        alt={showCharacterInfo ? characters[showCharacterInfo].name : ""}
                        fill
                        className="object-cover"
                      />
                    </div>
                    <div>
                      <p className="text-gray-300 mb-4">{showCharacterInfo && characters[showCharacterInfo].description}</p>
                    </div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      )}

      <AnimatePresence>
        {showTheoryModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
          >
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 20 }}
              className="bg-white rounded-xl max-w-4xl w-full max-h-[80vh] overflow-hidden flex flex-col text-black"
            >
              <div className="p-4 border-b border-blue-200 flex items-center justify-between">
                <h2 className="font-bold text-xl">Теоретические материалы</h2>
                <Button variant="ghost" size="icon" onClick={() => setShowTheoryModal(false)}>
                  <X className="h-5 w-5" />
                </Button>
              </div>

              <div className="flex flex-col md:flex-row flex-grow overflow-hidden">
                <div className="w-full md:w-64 border-r border-blue-200 p-4 overflow-y-auto">
                  {theoryTopics.map((topic, index) => (
                    <button
                      key={index}
                      className={cn(
                        "w-full text-left px-3 py-2 rounded-lg transition-colors mb-2",
                        currentTheoryTopic === index ? "bg-primary text-primary-foreground" : "hover:bg-gray-700",
                      )}
                      onClick={() => setCurrentTheoryTopic(index)}
                    >
                      {topic.title}
                    </button>
                  ))}
                </div>

                <div className="flex-grow p-6 overflow-y-auto">
                  <h3 className="text-2xl font-bold mb-6">{theoryTopics[currentTheoryTopic].title}</h3>
                  <div
                    className="prose prose-invert max-w-none"
                    dangerouslySetInnerHTML={{ __html: theoryTopics[currentTheoryTopic].content }}
                  />

                  <div className="mt-8 flex justify-between">
                    <Button
                      variant="outline"
                      onClick={() => setCurrentTheoryTopic(Math.max(0, currentTheoryTopic - 1))}
                      disabled={currentTheoryTopic === 0}
                      className="flex items-center gap-2"
                    >
                      <ArrowLeft className="h-4 w-4" />
                      Предыдущая тема
                    </Button>
                    <Button
                      variant="outline"
                      onClick={() => setCurrentTheoryTopic(Math.min(theoryTopics.length - 1, currentTheoryTopic + 1))}
                      disabled={currentTheoryTopic === theoryTopics.length - 1}
                      className="flex items-center gap-2"
                    >
                      Следующая тема
                      <ArrowRight className="h-4 w-4" />
                    </Button>
                  </div>
                </div>
              </div>

              <div className="p-4 border-t border-blue-200 flex justify-end">
                <Button
                  onClick={() => {
                    setShowTheoryModal(false)
                    if (gameState === "theory") setGameState("intro")
                  }}
                >
                  Закрыть
                </Button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {gameState === "end" && (
        <div className="min-h-screen flex flex-col items-center justify-center p-8 bg-gradient-to-b from-blue-50 to-white">
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="text-center mb-8"
          >
            <h1 className="text-4xl md:text-5xl font-bold mb-4">Расследование завершено</h1>
            <p className="text-xl text-gray-300 max-w-2xl mx-auto">
              Вы успешно раскрыли дело об убийстве Виктора Новикова
            </p>
          </motion.div>

          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.3, duration: 0.5 }}
            className="relative w-full max-w-4xl aspect-video rounded-xl overflow-hidden mb-8"
          >
            <Image
              src="/images/novel/visualprev.jpg?height=720&width=1280&text=Дело+раскрыто"
              alt="Дело раскрыто"
              fill
              className="object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end">
              <div className="p-8">
                <h2 className="text-2xl font-bold mb-2">Преступники наказаны, справедливость восторжествовала</h2>
                <p className="text-gray-800">
                  Благодаря вашим навыкам детектива, внимательности и логическому мышлению, убийцы были найдены и
                  арестованы.
                </p>
              </div>
            </div>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.6, duration: 0.5 }}
            className="flex flex-col md:flex-row gap-4"
          >
            <Button size="lg" onClick={() => setGameState("intro")} className="flex items-center gap-2">
              <Home className="h-5 w-5" />
              Вернуться в главное меню
            </Button>
            <Button
              size="lg"
              variant="outline"
              onClick={() => setShowTheoryModal(true)}
              className="flex items-center gap-2"
            >
              <BookOpen className="h-5 w-5" />
              Теоретические материалы
            </Button>
          </motion.div>
        </div>
      )}
    </div>
  )
}

